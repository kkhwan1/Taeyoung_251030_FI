# 미완료 레코드 해결 가이드

**작성일**: 2025년 1월 30일
**대상**: 입고 거래 단가 미입력 3건
**목적**: 실무 담당자를 위한 단계별 해결 가이드

## 📚 관련 문서
- [종합 분석 보고서](./종합_분석_보고서.md) - 전체 작업 분석 및 통계
- [입고 단가 채우기 최종 분석](./입고_단가_채우기_최종_분석.md) - 기술 상세 분석
- [가격 정보 채우기 완료 보고서](./PRICE_POPULATION_COMPLETE.md) - 완료 요약 보고서
- [입고 거래 최종 임포트 보고서](./INBOUND_IMPORT_FINAL_SUMMARY.md) - 프로젝트 전체 현황

---

## 📋 개요

### 미완료 레코드 현황

| 거래번호 | 품목코드 (Excel) | 품목코드 (DB) | 수량 | 문제 유형 | 우선순위 |
|----------|-----------------|--------------|------|----------|----------|
| IN-2025-0039 | 69138-EV000 | 81836-R0500 | 9,100개 | 코드 불일치 | 🔴 높음 |
| IN-2025-0040 | 69148-EV000 | 81846-R0500 | 8,400개 | 코드 불일치 | 🔴 높음 |
| IN-2025-0065 | 50011721D | 50011721D | 3,584개 | 가격 누락 | 🟡 중간 |

**총 영향**: 21,084개 제품, 추정 금액 ₩79M ~ ₩234M

---

## 🔍 레코드 1: IN-2025-0039

### 기본 정보

```yaml
거래번호: IN-2025-0039
거래일자: 2025-01-15
거래 유형: 입고
공급사: 웅지테크 (company_id: 170)
수량: 9,100개
현재 상태: unit_price = null, total_amount = null
```

### 품목 정보

**데이터베이스 (items 테이블)**:
```yaml
item_id: 4411
item_code: 81836-R0500
item_name: BRKT-T/GATE LIFTER,LH (일반사양)
description: B/HEAD-RR TRANSVESE,LH
category: 원자재
supplier_id: null (⚠️ 미입력)
```

**Excel 원본**:
```yaml
item_code: 69138-EV000
```

### 문제 분석

**근본 원인**: 품목 코드 불일치
- Excel에 입력된 코드: `69138-EV000`
- 데이터베이스 실제 코드: `81836-R0500`
- Price Master에는 `69138-EV000` 가격 정보 없음

**가능한 시나리오**:
1. Excel 입력 시 잘못된 품목 코드 사용
2. 품목 코드 체계 변경 (69xxx → 81xxx)
3. 공급사 변경으로 코드 변경 (EV → R)

### 해결 방법

#### 방법 1: Excel 원본 확인 (권장)

**체크리스트**:
- [ ] 원본 Excel 파일 열기
- [ ] 해당 거래 행 찾기 (거래일 2025-01-15, 수량 9,100)
- [ ] 품목 코드가 정말 `69138-EV000`인지 확인
- [ ] 공급사 견적서와 대조

**확인 결과별 조치**:

**Case A: Excel이 틀린 경우 (코드는 81836-R0500이 맞음)**
```sql
-- Price Master에 81836-R0500 가격이 있는지 확인
SELECT * FROM price_master WHERE item_code = '81836-R0500';

-- 가격이 있으면:
UPDATE inventory_transactions
SET unit_price = (SELECT price FROM price_master WHERE item_code = '81836-R0500'),
    total_amount = 9100 * (SELECT price FROM price_master WHERE item_code = '81836-R0500')
WHERE transaction_number = 'IN-2025-0039';

-- 가격이 없으면 방법 2로 진행
```

**Case B: 품목 코드가 변경된 경우 (69138-EV000 → 81836-R0500)**
```sql
-- 1. 매핑 테이블에 등록
INSERT INTO item_code_mappings (old_code, new_code, effective_date, notes)
VALUES ('69138-EV000', '81836-R0500', '2024-01-01', 'BRKT-T/GATE LIFTER,LH 코드 변경');

-- 2. Price Master에 구 코드로도 가격 등록 (임시)
-- 또는 신 코드로 가격 등록

-- 3. 거래 업데이트
UPDATE inventory_transactions
SET unit_price = [확인된 단가],
    total_amount = 9100 * [확인된 단가]
WHERE transaction_number = 'IN-2025-0039';
```

#### 방법 2: 공급사 견적서 확인

**연락처 정보**:
```
공급사: 웅지테크
담당자: [구매팀에서 확인]
연락처: [구매팀에서 확인]
```

**문의 내용 템플릿**:
```
안녕하세요, 태창 구매팀입니다.

2025년 1월 15일 입고 건 관련 단가 확인 요청드립니다.

품목명: BRKT-T/GATE LIFTER,LH (일반사양)
비고: B/HEAD-RR TRANSVESE,LH
수량: 9,100개
거래일: 2025-01-15

다음 중 어떤 품목 코드가 맞는지 확인 부탁드립니다:
1. 69138-EV000 (Excel 기록)
2. 81836-R0500 (시스템 기록)

해당 품목의 2025년 4월 단가도 함께 회신 부탁드립니다.

감사합니다.
```

**견적서 수령 후 조치**:
```sql
-- 1. Price Master 업데이트
INSERT INTO price_master (item_code, price, supplier, price_month, valid)
VALUES ('[확인된 코드]', [확인된 단가], '웅지테크', '2025-04', true)
ON CONFLICT (item_code, price_month) DO UPDATE
SET price = EXCLUDED.price;

-- 2. 거래 업데이트
UPDATE inventory_transactions
SET unit_price = [확인된 단가],
    total_amount = 9100 * [확인된 단가]
WHERE transaction_number = 'IN-2025-0039';
```

#### 방법 3: 유사 부품 단가 적용 (임시)

⚠️ **주의**: 정확한 단가 확인 전까지 임시 조치

**유사 부품 조회**:
```sql
-- LH/RH 관련 유사 부품 단가 확인
SELECT
  item_code,
  item_name,
  price,
  supplier
FROM price_master
WHERE item_name LIKE '%BRKT%LIFTER%'
   OR item_name LIKE '%GATE%'
ORDER BY price;
```

**추정 단가 범위**: ₩3,000 ~ ₩9,000 (유사 부품 기준)

```sql
-- 임시 단가 적용 (예: ₩4,500)
UPDATE inventory_transactions
SET unit_price = 4500,
    total_amount = 9100 * 4500,
    notes = CONCAT(COALESCE(notes, ''), ' [임시 단가: 확인 필요]')
WHERE transaction_number = 'IN-2025-0039';
```

---

## 🔍 레코드 2: IN-2025-0040

### 기본 정보

```yaml
거래번호: IN-2025-0040
거래일자: 2025-01-15
거래 유형: 입고
공급사: 웅지테크 (company_id: 170)
수량: 8,400개
현재 상태: unit_price = null, total_amount = null
```

### 품목 정보

**데이터베이스 (items 테이블)**:
```yaml
item_id: 4412
item_code: 81846-R0500
item_name: BRKT-T/GATE LIFTER,RH (일반사양)
description: B/HEAD-RR TRANSVESE,RH
category: 원자재
supplier_id: null (⚠️ 미입력)
```

**Excel 원본**:
```yaml
item_code: 69148-EV000
```

### 문제 분석

**근본 원인**: 품목 코드 불일치 (IN-2025-0039와 동일 패턴)
- Excel 코드: `69148-EV000`
- DB 코드: `81846-R0500`
- **특징**: IN-2025-0039의 대칭 부품 (LH ↔ RH)

### 해결 방법

⚠️ **IN-2025-0039와 동일한 방법으로 해결**

**차이점**:
- 품목 코드: 69138 → 69148, 81836 → 81846
- 수량: 9,100개 → 8,400개
- 부품 방향: LH → RH

**단가 추정**:
- LH/RH 대칭 부품은 보통 동일 단가
- IN-2025-0039 단가 확인 후 동일 단가 적용 가능

**빠른 적용 SQL**:
```sql
-- IN-2025-0039 해결 후, 동일 단가 적용
UPDATE inventory_transactions t2
SET unit_price = (
    SELECT unit_price
    FROM inventory_transactions
    WHERE transaction_number = 'IN-2025-0039'
  ),
  total_amount = 8400 * (
    SELECT unit_price
    FROM inventory_transactions
    WHERE transaction_number = 'IN-2025-0039'
  )
WHERE t2.transaction_number = 'IN-2025-0040';
```

---

## 🔍 레코드 3: IN-2025-0065

### 기본 정보

```yaml
거래번호: IN-2025-0065
거래일자: 2025-01-15
거래 유형: 입고
공급사: 호원사급 (company_id: 165)
수량: 3,584개
현재 상태: unit_price = null, total_amount = null
```

### 품목 정보

**데이터베이스 (items 테이블)**:
```yaml
item_id: 4429
item_code: 50011721D
item_name: ROLLO CASSETTE ASSY
description: ROLLO CASSETTE
category: 제품 (완제품)
supplier_id: null (⚠️ 미입력)
```

### 문제 분석

**근본 원인**: Price Master에 해당 품목 가격 없음
- 품목 코드: Excel과 DB 일치 (`50011721D`)
- 문제: Price Master 테이블에 `50011721D` 가격 없음

**가능한 원인**:
1. 신규 품목으로 아직 가격 미등록
2. 완제품 카테고리로 별도 관리
3. 버전 차이 (C, E 등 다른 버전은 있을 수 있음)
4. 특수 프로젝트용 품목

### 해결 방법

#### 방법 1: 공급사 견적서 확인 (권장)

**연락처 정보**:
```
공급사: 호원사급
담당자: [구매팀에서 확인]
연락처: [구매팀에서 확인]
```

**문의 내용 템플릿**:
```
안녕하세요, 태창 구매팀입니다.

2025년 1월 15일 입고 건 관련 단가 확인 요청드립니다.

품목 코드: 50011721D
품목명: ROLLO CASSETTE ASSY
수량: 3,584개
거래일: 2025-01-15

해당 품목의 2025년 4월 단가 회신 부탁드립니다.

감사합니다.
```

**견적서 수령 후 조치**:
```sql
-- 1. Price Master에 추가
INSERT INTO price_master (item_code, price, supplier, price_month, valid)
VALUES ('50011721D', [확인된 단가], '호원사급', '2025-04', true);

-- 2. 거래 업데이트
UPDATE inventory_transactions
SET unit_price = [확인된 단가],
    total_amount = 3584 * [확인된 단가]
WHERE transaction_number = 'IN-2025-0065';
```

#### 방법 2: 과거 거래 이력 조회

```sql
-- 같은 품목의 과거 거래 확인
SELECT
  transaction_number,
  transaction_date,
  quantity,
  unit_price,
  total_amount,
  notes
FROM inventory_transactions
WHERE item_id = 4429
  AND unit_price IS NOT NULL
ORDER BY transaction_date DESC
LIMIT 10;
```

**과거 거래가 있는 경우**:
```sql
-- 가장 최근 단가 적용
UPDATE inventory_transactions
SET unit_price = (
    SELECT unit_price
    FROM inventory_transactions
    WHERE item_id = 4429 AND unit_price IS NOT NULL
    ORDER BY transaction_date DESC
    LIMIT 1
  ),
  total_amount = 3584 * (
    SELECT unit_price
    FROM inventory_transactions
    WHERE item_id = 4429 AND unit_price IS NOT NULL
    ORDER BY transaction_date DESC
    LIMIT 1
  ),
  notes = CONCAT(COALESCE(notes, ''), ' [과거 거래 단가 적용]')
WHERE transaction_number = 'IN-2025-0065';
```

#### 방법 3: 유사 버전 단가 확인

```sql
-- 같은 시리즈의 다른 버전 조회
SELECT
  item_code,
  item_name,
  price,
  supplier
FROM price_master
WHERE item_code LIKE '50011721%'
   OR item_name LIKE '%ROLLO CASSETTE%';
```

**유사 버전이 있는 경우**:
- 버전 C (50011721C): 가격 확인
- 버전 E (50011721E): 가격 확인
- 가장 유사한 버전 단가 참고

---

## 📊 종합 실행 가이드

### 단계별 체크리스트

#### Phase 1: 정보 수집 (1-2시간)

- [ ] **Excel 원본 파일 확인**
  - [ ] 파일 위치: [경로 입력]
  - [ ] IN-2025-0039 행 확인
  - [ ] IN-2025-0040 행 확인
  - [ ] IN-2025-0065 행 확인

- [ ] **공급사 연락**
  - [ ] 웅지테크 담당자 연락 (2건)
  - [ ] 호원사급 담당자 연락 (1건)
  - [ ] 견적서 요청 발송

- [ ] **과거 거래 이력 조회**
  - [ ] 50011721D 거래 이력 확인
  - [ ] 유사 품목 단가 조회

#### Phase 2: 데이터 업데이트 (30분)

- [ ] **Price Master 업데이트**
```sql
-- 확인된 단가 입력
INSERT INTO price_master (item_code, price, supplier, price_month, valid)
VALUES
  ('69138-EV000', [단가1], '웅지테크', '2025-04', true),
  ('69148-EV000', [단가2], '웅지테크', '2025-04', true),
  ('50011721D', [단가3], '호원사급', '2025-04', true)
ON CONFLICT (item_code, price_month) DO UPDATE
SET price = EXCLUDED.price;
```

- [ ] **거래 업데이트**
```sql
-- IN-2025-0039
UPDATE inventory_transactions
SET unit_price = [단가1],
    total_amount = 9100 * [단가1]
WHERE transaction_number = 'IN-2025-0039';

-- IN-2025-0040
UPDATE inventory_transactions
SET unit_price = [단가2],
    total_amount = 8400 * [단가2]
WHERE transaction_number = 'IN-2025-0040';

-- IN-2025-0065
UPDATE inventory_transactions
SET unit_price = [단가3],
    total_amount = 3584 * [단가3]
WHERE transaction_number = 'IN-2025-0065';
```

#### Phase 3: 검증 (10분)

- [ ] **업데이트 검증**
```sql
-- 3개 레코드 확인
SELECT
  transaction_number,
  item_id,
  quantity,
  unit_price,
  total_amount,
  quantity * unit_price as calculated_total,
  total_amount = (quantity * unit_price) as amount_correct
FROM inventory_transactions
WHERE transaction_number IN ('IN-2025-0039', 'IN-2025-0040', 'IN-2025-0065');
```

- [ ] **전체 시스템 상태 확인**
```sql
-- 전체 입고 거래 현황
SELECT
  COUNT(*) as total_records,
  COUNT(unit_price) as with_price,
  COUNT(*) - COUNT(unit_price) as without_price,
  ROUND(COUNT(unit_price) * 100.0 / COUNT(*), 2) as coverage_percent,
  SUM(total_amount) as total_value
FROM inventory_transactions
WHERE transaction_type = '입고';

-- 목표: without_price = 0, coverage_percent = 100.00
```

---

## 🚨 문제 해결 FAQ

### Q1: 공급사에서 견적서를 보내주지 않으면?

**A**: 다음 대안 시도:
1. 구매팀 과거 메일 검색
2. ERP 시스템 과거 거래 조회
3. 다른 공급사 견적과 비교
4. 임시 단가 적용 후 추후 정산

### Q2: Excel 원본 파일을 찾을 수 없으면?

**A**:
1. 데이터베이스의 실제 코드 (`81836-R0500`, `81846-R0500`) 사용
2. 해당 코드로 Price Master 검색
3. 없으면 공급사 견적서 요청

### Q3: LH/RH 부품 단가가 다를 수 있나?

**A**:
- 일반적으로 대칭 부품은 동일 단가
- 드물게 금형 차이로 다를 수 있음
- 공급사 견적서로 최종 확인 필요

### Q4: 임시 단가 적용 후 나중에 수정하면?

**A**:
```sql
-- 임시 단가 적용 시 표시
UPDATE inventory_transactions
SET notes = CONCAT(COALESCE(notes, ''), ' [임시 단가: 확인 필요]')
WHERE transaction_number IN ('IN-2025-0039', 'IN-2025-0040', 'IN-2025-0065');

-- 나중에 정확한 단가로 수정
UPDATE inventory_transactions
SET unit_price = [정확한 단가],
    total_amount = quantity * [정확한 단가],
    notes = REPLACE(notes, ' [임시 단가: 확인 필요]', ' [단가 확인 완료]')
WHERE transaction_number = 'IN-2025-0039';
```

### Q5: 품목 코드 매핑 테이블은 어떻게 만들나?

**A**:
```sql
-- 테이블 생성
CREATE TABLE IF NOT EXISTS item_code_mappings (
  mapping_id SERIAL PRIMARY KEY,
  old_code VARCHAR(50) NOT NULL,
  new_code VARCHAR(50) NOT NULL,
  effective_date DATE NOT NULL,
  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(old_code, new_code)
);

-- 데이터 입력
INSERT INTO item_code_mappings (old_code, new_code, effective_date, notes)
VALUES
  ('69138-EV000', '81836-R0500', '2024-01-01', 'BRKT-T/GATE LIFTER,LH 코드 변경'),
  ('69148-EV000', '81846-R0500', '2024-01-01', 'BRKT-T/GATE LIFTER,RH 코드 변경');
```

---

## 📞 담당자 연락처

### 구매팀
- 담당자: [이름 입력]
- 연락처: [전화번호 입력]
- 이메일: [이메일 입력]

### IT팀
- 담당자: [이름 입력]
- 연락처: [전화번호 입력]
- 이메일: [이메일 입력]

### 공급사

**웅지테크**:
- 담당자: [이름 입력]
- 연락처: [전화번호 입력]
- 이메일: [이메일 입력]

**호원사급**:
- 담당자: [이름 입력]
- 연락처: [전화번호 입력]
- 이메일: [이메일 입력]

---

## 📝 작업 기록

### 작업 로그 템플릿

```
날짜: [작업 일자]
작업자: [이름]
작업 내용:
  - [ ] Excel 원본 확인
  - [ ] 공급사 견적서 수령
  - [ ] Price Master 업데이트
  - [ ] 거래 업데이트
  - [ ] 검증 완료

확인된 단가:
  - IN-2025-0039: ₩[단가]
  - IN-2025-0040: ₩[단가]
  - IN-2025-0065: ₩[단가]

특이사항:
  [내용 입력]
```

---

## ✅ 완료 기준

다음 조건이 모두 충족되면 작업 완료:

1. ✅ 3개 레코드 모두 `unit_price`와 `total_amount` 입력 완료
2. ✅ 계산 검증: `total_amount = quantity × unit_price`
3. ✅ 전체 입고 거래 커버리지: 1,000/1,000 (100%)
4. ✅ Price Master 업데이트 (3개 품목 추가)
5. ✅ 작업 로그 작성 완료

---

**작성일**: 2025년 1월 30일
**최종 수정**: 2025년 1월 30일
**버전**: 1.0
**상태**: 실행 준비 완료
