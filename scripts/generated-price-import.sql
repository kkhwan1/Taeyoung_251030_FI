-- ============================================
-- Full Price Import from Excel "ìµœì‹ ë‹¨ê°€"
-- Generated: 2025-10-30T13:34:09.608Z
-- Total Records: 244
-- ============================================

BEGIN;

-- ============================================
-- STEP 1: Backup Current Prices
-- ============================================

DROP TABLE IF EXISTS items_price_backup_1761831249612;
CREATE TABLE items_price_backup_1761831249612 AS
SELECT item_id, item_code, item_name, price, updated_at
FROM items WHERE is_active = true;

-- ============================================
-- STEP 2: Create Audit Log Table
-- ============================================

CREATE TABLE IF NOT EXISTS item_price_changes (
  change_id SERIAL PRIMARY KEY,
  item_code VARCHAR(50) NOT NULL,
  old_price NUMERIC(15,2),
  new_price NUMERIC(15,2) NOT NULL,
  price_diff NUMERIC(15,2),
  change_type VARCHAR(20) NOT NULL, -- INSERT, UPDATE, NO_CHANGE
  excel_supplier VARCHAR(100),
  changed_at TIMESTAMP DEFAULT NOW()
);

-- ============================================
-- STEP 3: Update Existing Items (CTE Method)
-- ============================================

WITH excel_prices AS (
  SELECT item_code, price, supplier FROM (VALUES
    ('50010562C', 785, 'íƒœì˜ê¸ˆì†'),
    ('69174-DO000', 1203, 'íƒœì˜ê¸ˆì†'),
    ('69184-DO000', 1203, 'íƒœì˜ê¸ˆì†'),
    ('69158-DO000', 451, 'íƒœì˜ê¸ˆì†'),
    ('69168-DO000', 450, 'íƒœì˜ê¸ˆì†'),
    ('69118-DO000', 158, 'íƒœì˜ê¸ˆì†'),
    ('50011721C', 2169, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50007278B', 2631, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50010755C', 2644, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50012110B', 1707, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('651M7-L2000', 298.6, 'ì›…ì§€í…Œí¬'),
    ('65158-L8000', 561, 'ì›…ì§€í…Œí¬'),
    ('65168-L8000', 561, 'ì›…ì§€í…Œí¬'),
    ('651E3-L8000', 391.68, 'ì›…ì§€í…Œí¬'),
    ('651F3-L8000', 391.68, 'ì›…ì§€í…Œí¬'),
    ('651E4-L8000', 279, 'ì›…ì§€í…Œí¬'),
    ('651F4-L8000', 279, 'ì›…ì§€í…Œí¬'),
    ('65278-L8000', 232, 'ì›…ì§€í…Œí¬'),
    ('65116-L3400', 935, 'ì›…ì§€í…Œí¬'),
    ('65126-L3400', 931, 'ì›…ì§€í…Œí¬'),
    ('65136-L8000', 205, 'ì›…ì§€í…Œí¬'),
    ('65136-L8400', 335, 'ì›…ì§€í…Œí¬'),
    ('65158-L8000/', 561, 'ì›…ì§€í…Œí¬'),
    ('65168-L8000/', 561, 'ì›…ì§€í…Œí¬'),
    ('651E4-L8000/', 279, 'ì›…ì§€í…Œí¬'),
    ('651F4-L8000/', 279, 'ì›…ì§€í…Œí¬'),
    ('65278-L8000/', 232, 'ì›…ì§€í…Œí¬'),
    ('65116-L3400/', 935, 'ì›…ì§€í…Œí¬'),
    ('65126-L3400/', 931, 'ì›…ì§€í…Œí¬'),
    ('651M7-L8400', 369.9, 'ì›…ì§€í…Œí¬'),
    ('50010988', 587, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010989', 587, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010990', 612, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010991', 612, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008630', 576, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008457', 440, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008458', 440, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008175', 965, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008009', 592, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008904', 1491, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011623A', 668, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011624A', 668, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009770', 131, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009772', 131, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009975B', 130, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009977B', 130, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009745', 57, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009877', 40, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009878', 40, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010027', 65, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010086', 39, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011944C', 204, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011955C', 204, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011939B', 508, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011941B', 508, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011957A', 576, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011937C', 137, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011938C', 137, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010992', 398, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010993', 398, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010567', 41, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010569', 41, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011800', 44, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011801', 44, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50000018C', 298, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('69116-DO000', 529, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81836-R0500', 462.51000000000005, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81846-R0500', 462.51000000000005, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81836-R0600', 575.4200000000001, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81846-R0600', 575.4200000000001, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50014454B', 118.4, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50032843A', 218, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50032844A', 218, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011385', 2680, 'ì‹ ì„±ì‚°ì—…'),
    ('50011384', 773, 'ì‹ ì„±ì‚°ì—…'),
    ('50011106C', 177, 'ê´‘ì„±ì‚°ì—…'),
    ('50009766A', 513, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009768A', 513, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009971C', 508, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009973C', 508, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69156-DO000', 349, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69166-DO000', 349, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69172-DO000', 266, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69182-DO000', 266, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('728A1-R0500', 518, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('728B1-R0500', 518, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('72815-R0500', 645, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('72816-R0500', 645, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65154-L8000', 986, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65164-L8000', 986, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65156-L8000', 1163, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65166-L8000', 1163, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('651M8-L8000', 113, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65136-L2800', 269, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('651M8-L2800', 305, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69116-EV000', 484, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69139-EV000', 59, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69156-EV000', 328, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69166-EV000', 328, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50011308', 1200, 'ê´‘ì„±ì‚°ì—…'),
    ('50011833', 46, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65152-L1000', 2425, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65162-L1000', 2424, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65152-L8000', 2439, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65162-L8000', 2439, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65158-L1000', 714, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65168-L1000', 714, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E4-L1000', 389, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F4-L1000', 389, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65176-L1000', 2323, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65186-L1000', 2323, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65154-L1000', 1210, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65164-L1000', 1210, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65156-L1000', 1106, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65166-L1000', 1106, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E6-L1000', 455, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F6-L1000', 455, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65282-L3400', 380, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65292-L3400', 380, 'í˜¸ì›ì‚¬ê¸‰'),
    ('652E6-L3400', 375, 'í˜¸ì›ì‚¬ê¸‰'),
    ('652F6-L3400', 375, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L1000', 4644, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L2500', 5034, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L3400', 5413, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L8000', 4946, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L8400', 4587, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65352-L1000', 499, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65362-L1000', 499, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65174-L1000', 797, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65184-L1000', 797, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65264-F6000', 70, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65294-D4000', 86, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65264-D4000', 86, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E2-L5000', 351, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F2-L5000', 351, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65172-L2000', 8937, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65182-L2000', 8937, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65172-L8000', 10915, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65182-L8000', 10915, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69145-AT000', 392, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69162-G8000', 275, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69156-DO000 (PAD)', 1403, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69166-DO000 (PAD)', 1403, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65996-C5000', 522, 'í˜¸ì›ì‚¬ê¸‰'),
    ('99242-06100', 16.25, 'í˜¸ì›ì‚¬ê¸‰'),
    ('êµ¬ì¡°ìš© ì ‘ì°©ì²´', 9700, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12904-06101', 17.39, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-1F000', 14.32, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-1R000', 19.078, 'í˜¸ì›ì‚¬ê¸‰'),
    ('84191-A7500', 38, 'í˜¸ì›ì‚¬ê¸‰'),
    ('81763-1Y000', 179.09199999999998, 'í˜¸ì›ì‚¬ê¸‰'),
    ('81838-R0600', 320, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13905-06000', 11.400000000000002, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13905-08000', 20.14, 'í˜¸ì›ì‚¬ê¸‰'),
    ('19353-07250', 181.14, 'í˜¸ì›ì‚¬ê¸‰'),
    ('10216-10000', 79.5, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13917-10120', 49.5, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12900-06140', 16.12, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12900-06180', 17.89, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-3V000', 13.05, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12922-06201', 35.56, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12971-06203', 29.316, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65178-L1000', 312.6, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65178-L3400', 414.9, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69146-AT000', 392, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65412-L1000', 828, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65422-L1000', 831, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65916-L1000', 89, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655N6-L1000', 1184, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655P6-L1000', 1184, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657N2-L1000', 990, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657P2-L1000', 949, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65832-L1000', 1587, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65852-L2000', 3022, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65554-D4000', 230, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655N6-L8400', 1132, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655P6-L8400', 1132, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65916-L8400', 123, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657A6-E2510', 1064, 'í’ê¸°ì‚¬ê¸‰'),
    ('657B6-E2510', 1064, 'í’ê¸°ì‚¬ê¸‰'),
    ('65512-A3000', 4421, 'í’ê¸°ì‚¬ê¸‰'),
    ('65512-E2510', 4783, 'í’ê¸°ì‚¬ê¸‰'),
    ('65821-1Y800', 142, 'í’ê¸°ì‚¬ê¸‰'),
    ('65837-A3000', 1006, 'í’ê¸°ì‚¬ê¸‰'),
    ('65847-A3000', 857, 'í’ê¸°ì‚¬ê¸‰'),
    ('65779-1Y010', 57, 'í’ê¸°ì‚¬ê¸‰'),
    ('65789-1Y010', 57, 'í’ê¸°ì‚¬ê¸‰'),
    ('65567-E2510', 608, 'í’ê¸°ì‚¬ê¸‰'),
    ('65598-E2510', 875, 'í’ê¸°ì‚¬ê¸‰'),
    ('65798-1Y000', 421.3, 'í’ê¸°ì‚¬ê¸‰'),
    ('64749-CV000', 458.5, 'í’ê¸°ì‚¬ê¸‰'),
    ('65523-A3500', 258, 'í’ê¸°ì‚¬ê¸‰'),
    ('50007752', 14.5, 'ëŒ€ì¼ì”¨ì—í”„í‹°'),
    ('50007315', 32, 'ëŒ€ì¼ì”¨ì—í”„í‹°'),
    ('12900-06201', 24, 'ì•„ì‹ ê¸ˆì†'),
    ('13905-05000', 10.3, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('13194-08220', 101.3, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('13911-08001', 53.6, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('65639-3K000', 151.1, 'ì•„ì‹ ê¸ˆì†'),
    ('65512-C5000', 7040, ''),
    ('65512-C5900', 7040, ''),
    ('65522-L8400', 5513, ''),
    ('65561-3E001', 12304, ''),
    ('65630-L2000', 13716, ''),
    ('65630-L2010', 13432, ''),
    ('65630-L2020', 12981, ''),
    ('65630-L2800', 11733, ''),
    ('65630-L5000', 12388, ''),
    ('65630-L5010', 12132, ''),
    ('65630-L8400', 13372, ''),
    ('65852-L3000', 3050, ''),
    ('71131-2F510', 30638, ''),
    ('71141-2F510', 30630, ''),
    ('71201-07000', 21775, ''),
    ('71201-3K001', 25631, ''),
    ('71201-3L001', 25241.05, ''),
    ('71202-07000', 21775, ''),
    ('71202-3K001', 25627, ''),
    ('71202-3L001', 25387.35, ''),
    ('71377-3R000', 7734, ''),
    ('71412-3R000', 3877, ''),
    ('71422-3R000', 3877, ''),
    ('71601-2G100', 37228, ''),
    ('71602-2G100', 35639, ''),
    ('71603-3E000', 34077, ''),
    ('71603-3E100', 25299.95, ''),
    ('71604-3E000', 38175, ''),
    ('71604-3E100', 26712.6, ''),
    ('71611-3E000', 21473, ''),
    ('71611-3E100', 20426, ''),
    ('71621-3E000', 19490, ''),
    ('71621-3E100', 21604, ''),
    ('71653-2P000', 2438, ''),
    ('71663-2P000', 2437, ''),
    ('71678-2P700', 2956, ''),
    ('71688-2P700', 2956, ''),
    ('71731-2P700', 2117, ''),
    ('71741-2P700', 2103, ''),
    ('76230-2G010', 20080, ''),
    ('76231-A7000', 1294, ''),
    ('76240-2G010', 20022, ''),
    ('76241-A7000', 1294, ''),
    ('77230-2G010', 20318, ''),
    ('77240-2G010', 20314.35, '')
  ) AS t(item_code, price, supplier)
),
price_updates AS (
  UPDATE items i
  SET
    price = e.price,
    updated_at = NOW()
  FROM excel_prices e
  WHERE i.item_code = e.item_code
    AND i.is_active = true
    AND (i.price IS NULL OR ABS(i.price - e.price) > 0.01)
  RETURNING i.item_code, i.price as new_price, e.supplier
)
INSERT INTO item_price_changes (item_code, new_price, change_type, excel_supplier)
SELECT item_code, new_price, 'UPDATE', supplier FROM price_updates;

-- ============================================
-- STEP 4: Insert Missing Items
-- ============================================

WITH excel_prices AS (
  SELECT item_code, price, supplier FROM (VALUES
    ('50010562C', 785, 'íƒœì˜ê¸ˆì†'),
    ('69174-DO000', 1203, 'íƒœì˜ê¸ˆì†'),
    ('69184-DO000', 1203, 'íƒœì˜ê¸ˆì†'),
    ('69158-DO000', 451, 'íƒœì˜ê¸ˆì†'),
    ('69168-DO000', 450, 'íƒœì˜ê¸ˆì†'),
    ('69118-DO000', 158, 'íƒœì˜ê¸ˆì†'),
    ('50011721C', 2169, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50007278B', 2631, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50010755C', 2644, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('50012110B', 1707, 'ì°½ê²½ì—ìŠ¤í…Œí¬'),
    ('651M7-L2000', 298.6, 'ì›…ì§€í…Œí¬'),
    ('65158-L8000', 561, 'ì›…ì§€í…Œí¬'),
    ('65168-L8000', 561, 'ì›…ì§€í…Œí¬'),
    ('651E3-L8000', 391.68, 'ì›…ì§€í…Œí¬'),
    ('651F3-L8000', 391.68, 'ì›…ì§€í…Œí¬'),
    ('651E4-L8000', 279, 'ì›…ì§€í…Œí¬'),
    ('651F4-L8000', 279, 'ì›…ì§€í…Œí¬'),
    ('65278-L8000', 232, 'ì›…ì§€í…Œí¬'),
    ('65116-L3400', 935, 'ì›…ì§€í…Œí¬'),
    ('65126-L3400', 931, 'ì›…ì§€í…Œí¬'),
    ('65136-L8000', 205, 'ì›…ì§€í…Œí¬'),
    ('65136-L8400', 335, 'ì›…ì§€í…Œí¬'),
    ('65158-L8000/', 561, 'ì›…ì§€í…Œí¬'),
    ('65168-L8000/', 561, 'ì›…ì§€í…Œí¬'),
    ('651E4-L8000/', 279, 'ì›…ì§€í…Œí¬'),
    ('651F4-L8000/', 279, 'ì›…ì§€í…Œí¬'),
    ('65278-L8000/', 232, 'ì›…ì§€í…Œí¬'),
    ('65116-L3400/', 935, 'ì›…ì§€í…Œí¬'),
    ('65126-L3400/', 931, 'ì›…ì§€í…Œí¬'),
    ('651M7-L8400', 369.9, 'ì›…ì§€í…Œí¬'),
    ('50010988', 587, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010989', 587, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010990', 612, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010991', 612, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008630', 576, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008457', 440, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008458', 440, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008175', 965, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008009', 592, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50008904', 1491, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011623A', 668, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011624A', 668, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009770', 131, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009772', 131, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009975B', 130, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009977B', 130, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009745', 57, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009877', 40, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50009878', 40, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010027', 65, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010086', 39, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011944C', 204, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011955C', 204, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011939B', 508, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011941B', 508, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011957A', 576, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011937C', 137, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011938C', 137, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010992', 398, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010993', 398, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010567', 41, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50010569', 41, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011800', 44, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011801', 44, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50000018C', 298, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('69116-DO000', 529, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81836-R0500', 462.51000000000005, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81846-R0500', 462.51000000000005, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81836-R0600', 575.4200000000001, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('81846-R0600', 575.4200000000001, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50014454B', 118.4, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50032843A', 218, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50032844A', 218, 'ì—ì´ì˜¤ì—ìŠ¤'),
    ('50011385', 2680, 'ì‹ ì„±ì‚°ì—…'),
    ('50011384', 773, 'ì‹ ì„±ì‚°ì—…'),
    ('50011106C', 177, 'ê´‘ì„±ì‚°ì—…'),
    ('50009766A', 513, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009768A', 513, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009971C', 508, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50009973C', 508, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69156-DO000', 349, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69166-DO000', 349, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69172-DO000', 266, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69182-DO000', 266, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('728A1-R0500', 518, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('728B1-R0500', 518, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('72815-R0500', 645, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('72816-R0500', 645, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65154-L8000', 986, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65164-L8000', 986, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65156-L8000', 1163, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65166-L8000', 1163, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('651M8-L8000', 113, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65136-L2800', 269, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('651M8-L2800', 305, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69116-EV000', 484, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69139-EV000', 59, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69156-EV000', 328, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('69166-EV000', 328, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('50011308', 1200, 'ê´‘ì„±ì‚°ì—…'),
    ('50011833', 46, 'ì œì´ì—ìŠ¤í…Œí¬'),
    ('65152-L1000', 2425, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65162-L1000', 2424, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65152-L8000', 2439, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65162-L8000', 2439, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65158-L1000', 714, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65168-L1000', 714, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E4-L1000', 389, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F4-L1000', 389, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65176-L1000', 2323, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65186-L1000', 2323, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65154-L1000', 1210, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65164-L1000', 1210, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65156-L1000', 1106, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65166-L1000', 1106, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E6-L1000', 455, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F6-L1000', 455, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65282-L3400', 380, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65292-L3400', 380, 'í˜¸ì›ì‚¬ê¸‰'),
    ('652E6-L3400', 375, 'í˜¸ì›ì‚¬ê¸‰'),
    ('652F6-L3400', 375, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L1000', 4644, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L2500', 5034, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L3400', 5413, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L8000', 4946, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65132-L8400', 4587, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65352-L1000', 499, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65362-L1000', 499, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65174-L1000', 797, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65184-L1000', 797, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65264-F6000', 70, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65294-D4000', 86, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65264-D4000', 86, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651E2-L5000', 351, 'í˜¸ì›ì‚¬ê¸‰'),
    ('651F2-L5000', 351, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65172-L2000', 8937, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65182-L2000', 8937, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65172-L8000', 10915, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65182-L8000', 10915, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69145-AT000', 392, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69162-G8000', 275, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69156-DO000 (PAD)', 1403, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69166-DO000 (PAD)', 1403, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65996-C5000', 522, 'í˜¸ì›ì‚¬ê¸‰'),
    ('99242-06100', 16.25, 'í˜¸ì›ì‚¬ê¸‰'),
    ('êµ¬ì¡°ìš© ì ‘ì°©ì²´', 9700, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12904-06101', 17.39, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-1F000', 14.32, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-1R000', 19.078, 'í˜¸ì›ì‚¬ê¸‰'),
    ('84191-A7500', 38, 'í˜¸ì›ì‚¬ê¸‰'),
    ('81763-1Y000', 179.09199999999998, 'í˜¸ì›ì‚¬ê¸‰'),
    ('81838-R0600', 320, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13905-06000', 11.400000000000002, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13905-08000', 20.14, 'í˜¸ì›ì‚¬ê¸‰'),
    ('19353-07250', 181.14, 'í˜¸ì›ì‚¬ê¸‰'),
    ('10216-10000', 79.5, 'í˜¸ì›ì‚¬ê¸‰'),
    ('13917-10120', 49.5, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12900-06140', 16.12, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12900-06180', 17.89, 'í˜¸ì›ì‚¬ê¸‰'),
    ('64372-3V000', 13.05, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12922-06201', 35.56, 'í˜¸ì›ì‚¬ê¸‰'),
    ('12971-06203', 29.316, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65178-L1000', 312.6, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65178-L3400', 414.9, 'í˜¸ì›ì‚¬ê¸‰'),
    ('69146-AT000', 392, 'í˜¸ì›ì‚¬ê¸‰'),
    ('65412-L1000', 828, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65422-L1000', 831, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65916-L1000', 89, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655N6-L1000', 1184, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655P6-L1000', 1184, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657N2-L1000', 990, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657P2-L1000', 949, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65832-L1000', 1587, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65852-L2000', 3022, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65554-D4000', 230, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655N6-L8400', 1132, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('655P6-L8400', 1132, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('65916-L8400', 123, 'ëŒ€ìš°ì‚¬ê¸‰'),
    ('657A6-E2510', 1064, 'í’ê¸°ì‚¬ê¸‰'),
    ('657B6-E2510', 1064, 'í’ê¸°ì‚¬ê¸‰'),
    ('65512-A3000', 4421, 'í’ê¸°ì‚¬ê¸‰'),
    ('65512-E2510', 4783, 'í’ê¸°ì‚¬ê¸‰'),
    ('65821-1Y800', 142, 'í’ê¸°ì‚¬ê¸‰'),
    ('65837-A3000', 1006, 'í’ê¸°ì‚¬ê¸‰'),
    ('65847-A3000', 857, 'í’ê¸°ì‚¬ê¸‰'),
    ('65779-1Y010', 57, 'í’ê¸°ì‚¬ê¸‰'),
    ('65789-1Y010', 57, 'í’ê¸°ì‚¬ê¸‰'),
    ('65567-E2510', 608, 'í’ê¸°ì‚¬ê¸‰'),
    ('65598-E2510', 875, 'í’ê¸°ì‚¬ê¸‰'),
    ('65798-1Y000', 421.3, 'í’ê¸°ì‚¬ê¸‰'),
    ('64749-CV000', 458.5, 'í’ê¸°ì‚¬ê¸‰'),
    ('65523-A3500', 258, 'í’ê¸°ì‚¬ê¸‰'),
    ('50007752', 14.5, 'ëŒ€ì¼ì”¨ì—í”„í‹°'),
    ('50007315', 32, 'ëŒ€ì¼ì”¨ì—í”„í‹°'),
    ('12900-06201', 24, 'ì•„ì‹ ê¸ˆì†'),
    ('13905-05000', 10.3, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('13194-08220', 101.3, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('13911-08001', 53.6, 'ì‚¼ì§„ìŠ¤í‹¸'),
    ('65639-3K000', 151.1, 'ì•„ì‹ ê¸ˆì†'),
    ('65512-C5000', 7040, ''),
    ('65512-C5900', 7040, ''),
    ('65522-L8400', 5513, ''),
    ('65561-3E001', 12304, ''),
    ('65630-L2000', 13716, ''),
    ('65630-L2010', 13432, ''),
    ('65630-L2020', 12981, ''),
    ('65630-L2800', 11733, ''),
    ('65630-L5000', 12388, ''),
    ('65630-L5010', 12132, ''),
    ('65630-L8400', 13372, ''),
    ('65852-L3000', 3050, ''),
    ('71131-2F510', 30638, ''),
    ('71141-2F510', 30630, ''),
    ('71201-07000', 21775, ''),
    ('71201-3K001', 25631, ''),
    ('71201-3L001', 25241.05, ''),
    ('71202-07000', 21775, ''),
    ('71202-3K001', 25627, ''),
    ('71202-3L001', 25387.35, ''),
    ('71377-3R000', 7734, ''),
    ('71412-3R000', 3877, ''),
    ('71422-3R000', 3877, ''),
    ('71601-2G100', 37228, ''),
    ('71602-2G100', 35639, ''),
    ('71603-3E000', 34077, ''),
    ('71603-3E100', 25299.95, ''),
    ('71604-3E000', 38175, ''),
    ('71604-3E100', 26712.6, ''),
    ('71611-3E000', 21473, ''),
    ('71611-3E100', 20426, ''),
    ('71621-3E000', 19490, ''),
    ('71621-3E100', 21604, ''),
    ('71653-2P000', 2438, ''),
    ('71663-2P000', 2437, ''),
    ('71678-2P700', 2956, ''),
    ('71688-2P700', 2956, ''),
    ('71731-2P700', 2117, ''),
    ('71741-2P700', 2103, ''),
    ('76230-2G010', 20080, ''),
    ('76231-A7000', 1294, ''),
    ('76240-2G010', 20022, ''),
    ('76241-A7000', 1294, ''),
    ('77230-2G010', 20318, ''),
    ('77240-2G010', 20314.35, '')
  ) AS t(item_code, price, supplier)
),
missing_items AS (
  SELECT e.item_code, e.price, e.supplier
  FROM excel_prices e
  LEFT JOIN items i ON i.item_code = e.item_code AND i.is_active = true
  WHERE i.item_code IS NULL
),
new_items AS (
  INSERT INTO items (
    item_code,
    item_name,
    category,
    price,
    is_active,
    created_at,
    updated_at
  )
  SELECT
    item_code,
    'IMPORTED FROM EXCEL - ìµœì‹ ë‹¨ê°€' || CASE WHEN supplier != '' THEN ' (' || supplier || ')' ELSE '' END,
    'ì›ìžìž¬',
    price,
    true,
    NOW(),
    NOW()
  FROM missing_items
  RETURNING item_code, price
)
INSERT INTO item_price_changes (item_code, new_price, change_type)
SELECT item_code, price, 'INSERT' FROM new_items;

-- ============================================
-- STEP 5: Verification & Statistics
-- ============================================

-- Summary of changes
SELECT
  change_type,
  COUNT(*) as count,
  ROUND(AVG(new_price), 2) as avg_price,
  MIN(new_price) as min_price,
  MAX(new_price) as max_price
FROM item_price_changes
WHERE changed_at >= NOW() - INTERVAL '1 minute'
GROUP BY change_type;

-- Items with largest price changes
SELECT
  ipc.item_code,
  i.item_name,
  ipc.old_price,
  ipc.new_price,
  ipc.price_diff,
  ROUND(ABS(ipc.price_diff) / NULLIF(ipc.old_price, 0) * 100, 2) as percent_change
FROM item_price_changes ipc
JOIN items i ON i.item_code = ipc.item_code
WHERE ipc.changed_at >= NOW() - INTERVAL '1 minute'
  AND ipc.change_type = 'UPDATE'
  AND ABS(ipc.price_diff) > 100
ORDER BY ABS(ipc.price_diff) DESC
LIMIT 20;

-- Overall database price coverage
SELECT
  COUNT(*) as total_items,
  COUNT(CASE WHEN price IS NOT NULL THEN 1 END) as items_with_price,
  COUNT(CASE WHEN price IS NULL THEN 1 END) as items_without_price,
  ROUND(COUNT(CASE WHEN price IS NOT NULL THEN 1 END) * 100.0 / COUNT(*), 2) as price_coverage_pct
FROM items
WHERE is_active = true;

COMMIT;

-- To rollback: ROLLBACK;

âœ… SQL generation complete!
ðŸ“Š Generated statements for 244 price records
ðŸ“ Review the output before execution

ðŸ’¡ To save: node scripts/import-all-excel-prices.js > scripts/generated-price-import.sql
