
-- Full comparison of Excel BOM 최신단가 vs Database
WITH excel_prices AS (
  SELECT item_code, price, supplier
  FROM (VALUES
    ('50010562C', 785, '태영금속'),
    ('69174-DO000', 1203, '태영금속'),
    ('69184-DO000', 1203, '태영금속'),
    ('69158-DO000', 451, '태영금속'),
    ('69168-DO000', 450, '태영금속'),
    ('69118-DO000', 158, '태영금속'),
    ('50011721C', 2169, '창경에스테크'),
    ('50007278B', 2631, '창경에스테크'),
    ('50010755C', 2644, '창경에스테크'),
    ('50012110B', 1707, '창경에스테크'),
    ('651M7-L2000', 298.6, '웅지테크'),
    ('65158-L8000', 561, '웅지테크'),
    ('65168-L8000', 561, '웅지테크'),
    ('651E3-L8000', 391.68, '웅지테크'),
    ('651F3-L8000', 391.68, '웅지테크'),
    ('651E4-L8000', 279, '웅지테크'),
    ('651F4-L8000', 279, '웅지테크'),
    ('65278-L8000', 232, '웅지테크'),
    ('65116-L3400', 935, '웅지테크'),
    ('65126-L3400', 931, '웅지테크'),
    ('65136-L8000', 205, '웅지테크'),
    ('65136-L8400', 335, '웅지테크'),
    ('65158-L8000/', 561, '웅지테크'),
    ('65168-L8000/', 561, '웅지테크'),
    ('651E4-L8000/', 279, '웅지테크'),
    ('651F4-L8000/', 279, '웅지테크'),
    ('65278-L8000/', 232, '웅지테크'),
    ('65116-L3400/', 935, '웅지테크'),
    ('65126-L3400/', 931, '웅지테크'),
    ('651M7-L8400', 369.9, '웅지테크'),
    ('50010988', 587, '에이오에스'),
    ('50010989', 587, '에이오에스'),
    ('50010990', 612, '에이오에스'),
    ('50010991', 612, '에이오에스'),
    ('50008630', 576, '에이오에스'),
    ('50008457', 440, '에이오에스'),
    ('50008458', 440, '에이오에스'),
    ('50008175', 965, '에이오에스'),
    ('50008009', 592, '에이오에스'),
    ('50008904', 1491, '에이오에스'),
    ('50011623A', 668, '에이오에스'),
    ('50011624A', 668, '에이오에스'),
    ('50009770', 131, '에이오에스'),
    ('50009772', 131, '에이오에스'),
    ('50009975B', 130, '에이오에스'),
    ('50009977B', 130, '에이오에스'),
    ('50009745', 57, '에이오에스'),
    ('50009877', 40, '에이오에스'),
    ('50009878', 40, '에이오에스'),
    ('50010027', 65, '에이오에스'),
    ('50010086', 39, '에이오에스'),
    ('50011944C', 204, '에이오에스'),
    ('50011955C', 204, '에이오에스'),
    ('50011939B', 508, '에이오에스'),
    ('50011941B', 508, '에이오에스'),
    ('50011957A', 576, '에이오에스'),
    ('50011937C', 137, '에이오에스'),
    ('50011938C', 137, '에이오에스'),
    ('50010992', 398, '에이오에스'),
    ('50010993', 398, '에이오에스'),
    ('50010567', 41, '에이오에스'),
    ('50010569', 41, '에이오에스'),
    ('50011800', 44, '에이오에스'),
    ('50011801', 44, '에이오에스'),
    ('50000018C', 298, '에이오에스'),
    ('69116-DO000', 529, '에이오에스'),
    ('81836-R0500', 462.51000000000005, '에이오에스'),
    ('81846-R0500', 462.51000000000005, '에이오에스'),
    ('81836-R0600', 575.4200000000001, '에이오에스'),
    ('81846-R0600', 575.4200000000001, '에이오에스'),
    ('50014454B', 118.4, '에이오에스'),
    ('50032843A', 218, '에이오에스'),
    ('50032844A', 218, '에이오에스'),
    ('50011385', 2680, '신성산업'),
    ('50011384', 773, '신성산업'),
    ('50011106C', 177, '광성산업'),
    ('50009766A', 513, '제이에스테크'),
    ('50009768A', 513, '제이에스테크'),
    ('50009971C', 508, '제이에스테크'),
    ('50009973C', 508, '제이에스테크'),
    ('69156-DO000', 349, '제이에스테크'),
    ('69166-DO000', 349, '제이에스테크'),
    ('69172-DO000', 266, '제이에스테크'),
    ('69182-DO000', 266, '제이에스테크'),
    ('728A1-R0500', 518, '제이에스테크'),
    ('728B1-R0500', 518, '제이에스테크'),
    ('72815-R0500', 645, '제이에스테크'),
    ('72816-R0500', 645, '제이에스테크'),
    ('65154-L8000', 986, '제이에스테크'),
    ('65164-L8000', 986, '제이에스테크'),
    ('65156-L8000', 1163, '제이에스테크'),
    ('65166-L8000', 1163, '제이에스테크'),
    ('651M8-L8000', 113, '제이에스테크'),
    ('65136-L2800', 269, '제이에스테크'),
    ('651M8-L2800', 305, '제이에스테크'),
    ('69116-EV000', 484, '제이에스테크'),
    ('69139-EV000', 59, '제이에스테크'),
    ('69156-EV000', 328, '제이에스테크'),
    ('69166-EV000', 328, '제이에스테크'),
    ('50011308', 1200, '광성산업'),
    ('50011833', 46, '제이에스테크'),
    ('65152-L1000', 2425, '호원사급'),
    ('65162-L1000', 2424, '호원사급'),
    ('65152-L8000', 2439, '호원사급'),
    ('65162-L8000', 2439, '호원사급'),
    ('65158-L1000', 714, '호원사급'),
    ('65168-L1000', 714, '호원사급'),
    ('651E4-L1000', 389, '호원사급'),
    ('651F4-L1000', 389, '호원사급'),
    ('65176-L1000', 2323, '호원사급'),
    ('65186-L1000', 2323, '호원사급'),
    ('65154-L1000', 1210, '호원사급'),
    ('65164-L1000', 1210, '호원사급'),
    ('65156-L1000', 1106, '호원사급'),
    ('65166-L1000', 1106, '호원사급'),
    ('651E6-L1000', 455, '호원사급'),
    ('651F6-L1000', 455, '호원사급'),
    ('65282-L3400', 380, '호원사급'),
    ('65292-L3400', 380, '호원사급'),
    ('652E6-L3400', 375, '호원사급'),
    ('652F6-L3400', 375, '호원사급'),
    ('65132-L1000', 4644, '호원사급'),
    ('65132-L2500', 5034, '호원사급'),
    ('65132-L3400', 5413, '호원사급'),
    ('65132-L8000', 4946, '호원사급'),
    ('65132-L8400', 4587, '호원사급'),
    ('65352-L1000', 499, '호원사급'),
    ('65362-L1000', 499, '호원사급'),
    ('65174-L1000', 797, '호원사급'),
    ('65184-L1000', 797, '호원사급'),
    ('65264-F6000', 70, '호원사급'),
    ('65294-D4000', 86, '호원사급'),
    ('65264-D4000', 86, '호원사급'),
    ('651E2-L5000', 351, '호원사급'),
    ('651F2-L5000', 351, '호원사급'),
    ('65172-L2000', 8937, '호원사급'),
    ('65182-L2000', 8937, '호원사급'),
    ('65172-L8000', 10915, '호원사급'),
    ('65182-L8000', 10915, '호원사급'),
    ('69145-AT000', 392, '호원사급'),
    ('69162-G8000', 275, '호원사급'),
    ('69156-DO000 (PAD)', 1403, '호원사급'),
    ('69166-DO000 (PAD)', 1403, '호원사급'),
    ('65996-C5000', 522, '호원사급'),
    ('99242-06100', 16.25, '호원사급'),
    ('구조용 접착체', 9700, '호원사급'),
    ('12904-06101', 17.39, '호원사급'),
    ('64372-1F000', 14.32, '호원사급'),
    ('64372-1R000', 19.078, '호원사급'),
    ('84191-A7500', 38, '호원사급'),
    ('81763-1Y000', 179.09199999999998, '호원사급'),
    ('81838-R0600', 320, '호원사급'),
    ('13905-06000', 11.400000000000002, '호원사급'),
    ('13905-08000', 20.14, '호원사급'),
    ('19353-07250', 181.14, '호원사급'),
    ('10216-10000', 79.5, '호원사급'),
    ('13917-10120', 49.5, '호원사급'),
    ('12900-06140', 16.12, '호원사급'),
    ('12900-06180', 17.89, '호원사급'),
    ('64372-3V000', 13.05, '호원사급'),
    ('12922-06201', 35.56, '호원사급'),
    ('12971-06203', 29.316, '호원사급'),
    ('65178-L1000', 312.6, '호원사급'),
    ('65178-L3400', 414.9, '호원사급'),
    ('69146-AT000', 392, '호원사급'),
    ('65412-L1000', 828, '대우사급'),
    ('65422-L1000', 831, '대우사급'),
    ('65916-L1000', 89, '대우사급'),
    ('655N6-L1000', 1184, '대우사급'),
    ('655P6-L1000', 1184, '대우사급'),
    ('657N2-L1000', 990, '대우사급'),
    ('657P2-L1000', 949, '대우사급'),
    ('65832-L1000', 1587, '대우사급'),
    ('65852-L2000', 3022, '대우사급'),
    ('65554-D4000', 230, '대우사급'),
    ('655N6-L8400', 1132, '대우사급'),
    ('655P6-L8400', 1132, '대우사급'),
    ('65916-L8400', 123, '대우사급'),
    ('657A6-E2510', 1064, '풍기사급'),
    ('657B6-E2510', 1064, '풍기사급'),
    ('65512-A3000', 4421, '풍기사급'),
    ('65512-E2510', 4783, '풍기사급'),
    ('65821-1Y800', 142, '풍기사급'),
    ('65837-A3000', 1006, '풍기사급'),
    ('65847-A3000', 857, '풍기사급'),
    ('65779-1Y010', 57, '풍기사급'),
    ('65789-1Y010', 57, '풍기사급'),
    ('65567-E2510', 608, '풍기사급'),
    ('65598-E2510', 875, '풍기사급'),
    ('65798-1Y000', 421.3, '풍기사급'),
    ('64749-CV000', 458.5, '풍기사급'),
    ('65523-A3500', 258, '풍기사급'),
    ('50007752', 14.5, '대일씨에프티'),
    ('50007315', 32, '대일씨에프티'),
    ('12900-06201', 24, '아신금속'),
    ('13905-05000', 10.3, '삼진스틸'),
    ('13194-08220', 101.3, '삼진스틸'),
    ('13911-08001', 53.6, '삼진스틸'),
    ('65639-3K000', 151.1, '아신금속'),
    ('65512-C5000', 7040, ''),
    ('65512-C5900', 7040, ''),
    ('65522-L8400', 5513, ''),
    ('65561-3E001', 12304, ''),
    ('65630-L2000', 13716, ''),
    ('65630-L2010', 13432, ''),
    ('65630-L2020', 12981, ''),
    ('65630-L2800', 11733, ''),
    ('65630-L5000', 12388, ''),
    ('65630-L5010', 12132, ''),
    ('65630-L8400', 13372, ''),
    ('65852-L3000', 3050, ''),
    ('71131-2F510', 30638, ''),
    ('71141-2F510', 30630, ''),
    ('71201-07000', 21775, ''),
    ('71201-3K001', 25631, ''),
    ('71201-3L001', 25241.05, ''),
    ('71202-07000', 21775, ''),
    ('71202-3K001', 25627, ''),
    ('71202-3L001', 25387.35, ''),
    ('71377-3R000', 7734, ''),
    ('71412-3R000', 3877, ''),
    ('71422-3R000', 3877, ''),
    ('71601-2G100', 37228, ''),
    ('71602-2G100', 35639, ''),
    ('71603-3E000', 34077, ''),
    ('71603-3E100', 25299.95, ''),
    ('71604-3E000', 38175, ''),
    ('71604-3E100', 26712.6, ''),
    ('71611-3E000', 21473, ''),
    ('71611-3E100', 20426, ''),
    ('71621-3E000', 19490, ''),
    ('71621-3E100', 21604, ''),
    ('71653-2P000', 2438, ''),
    ('71663-2P000', 2437, ''),
    ('71678-2P700', 2956, ''),
    ('71688-2P700', 2956, ''),
    ('71731-2P700', 2117, ''),
    ('71741-2P700', 2103, ''),
    ('76230-2G010', 20080, ''),
    ('76231-A7000', 1294, ''),
    ('76240-2G010', 20022, ''),
    ('76241-A7000', 1294, ''),
    ('77230-2G010', 20318, ''),
    ('77240-2G010', 20314.35, '')
  ) AS t(item_code, price, supplier)
)
SELECT
  COALESCE(i.item_code, e.item_code) as item_code,
  i.item_name,
  i.category,
  i.price as db_price,
  e.price as excel_price,
  e.supplier as excel_supplier,
  CASE
    WHEN i.item_code IS NULL THEN 'NOT_IN_DB'
    WHEN i.price IS NULL THEN 'DB_PRICE_NULL'
    WHEN ABS(i.price - e.price) < 0.01 THEN 'MATCH'
    ELSE 'MISMATCH'
  END as status,
  ROUND(i.price - e.price, 2) as price_diff
FROM excel_prices e
LEFT JOIN items i ON i.item_code = e.item_code AND i.is_active = true
ORDER BY
  CASE
    WHEN i.item_code IS NULL THEN 1
    WHEN i.price IS NULL THEN 2
    WHEN ABS(i.price - e.price) > 0.01 THEN 3
    ELSE 4
  END,
  item_code;
