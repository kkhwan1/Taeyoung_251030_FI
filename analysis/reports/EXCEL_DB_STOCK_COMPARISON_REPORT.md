# Excel vs DB 재고 비교 분석 리포트

**분석 일시**: 2025-11-05
**데이터 소스**: 태창금속 BOM.xlsx
**총 타겟 품목**: 41개
**Excel 발견**: 32개 (78.0%)
**미발견**: 9개 (22.0%)

---

## 🎯 핵심 발견사항

### 1. Excel 재고 상태 요약

| 상태 | 품목 수 | 설명 |
|------|---------|------|
| **재고 0인 품목** | 26개 (81.3%) | Excel에 품목은 있으나 재고 0 |
| **재고 있는 품목** | 3개 (9.4%) | Excel에 실제 재고 존재 |
| **재고 정보 없음** | 3개 (9.4%) | 빈 값 (empty string) |
| **BOM에 없음** | 9개 (22.0%) | Excel BOM 파일에서 아예 발견 안됨 |

### 2. 재고가 실제로 있는 3개 품목

| 품목코드 | 품목명 | DB 재고 | Excel 재고 | 차이 | 시트 |
|---------|--------|---------|-----------|------|------|
| **65175-L1000** | REINF-SIDE SILL RR,LH | **-6,396** | **10,380** | +16,776 | 호원오토 |
| **65185-L1000** | REINF-SIDE SILL RR,RH | **-6,396** | **10,380** | +16,776 | 호원오토 |
| **81836-R0600** | BRKT-T/GATE LIFTER,LH (파워사양) | **-26,858** | **8,160** | +35,018 | 호원오토 |

**💡 분석**:
- 이 3개 품목만 Excel에 실제 재고가 기록되어 있음
- DB에는 음수인데 Excel에는 양수 → **데이터 불일치 확인**
- 총 차이: +68,570개 (Excel이 DB보다 많음)

### 3. 재고 0인 품목 (26개)

DB에는 음수이지만 Excel BOM에는 **재고 0**으로 기록된 품목들:

**주요 품목 (상위 5개)**:
| 품목코드 | 품목명 | DB 재고 | Excel 재고 |
|---------|--------|---------|-----------|
| 12900-06140 | BOLT-WELD | **-41,124** | **0** |
| 50007315 | M5 INSERT BOLT | **-31,600** | **0** |
| 65264-F6000 | BRKT-CTR DR SCUFF MTG,LH (ALL) | **-28,246** | **0** |
| 65176-L1000 | MEMBER-FR SEAT CROSS RR,LH | **-21,904** | **0** |
| 69156-DO000 | BULKHEAD-RR TRANSVERSE,LH | **-20,831** | **0** |

**💡 분석**:
- 이 품목들은 BOM에는 등록되어 있으나 재고가 0
- DB 음수는 출고/생산 거래가 있었으나 초기 재고가 설정되지 않았음을 의미

### 4. BOM에서 아예 발견되지 않은 9개 품목

| 품목코드 | 품목명 | DB 재고 |
|---------|--------|---------|
| 65264-R6000 | BRKT-CTR DR SCUFF MTG,RH (ALL) | -17,620 |
| 65230-R1000 | BRKT-FR SEAT RR INR MTG,RH | -6,396 |
| 65240-L1000 | BRKT-FR SEAT RR INR MTG,LH | -6,396 |
| 65246-L1000 | PATCH-S/SILL INR,LH | -6,396 |
| 65256-R1000 | PATCH-S/SILL INR,RH | -6,396 |
| 65171-L1000 | REINF-FR SEAT CROSS MBR SD,LH | -6,396 |
| 65181-L1000 | REINF-FR SEAT CROSS MBR SD,RH | -6,396 |
| 65870-R1000 | REINF-CTR FLOOR SD EXT,RH | -6,396 |
| 65860-L1000 | REINF-CTR FLOOR SD EXT,LH | -6,396 |

**총 9개 품목**: -74,424개

**💡 분석**:
- 이 품목들은 고객사별 BOM 시트에 존재하지 않음
- 다른 Excel 파일 또는 다른 시스템에 재고 정보가 있을 가능성
- DB에는 거래 기록이 있어 음수 발생

---

## 🔍 Excel 파일 구조 분석

### 검색한 시트 목록

| 시트명 | 크기 | 타겟 품목 발견 | 비고 |
|--------|------|--------------|------|
| **호원오토** | 228행 × 36열 | **29개** | ✅ 가장 많은 품목 발견 |
| **인알파코리아** | 150행 × 36열 | **3개** | M5 볼트류 발견 |
| 대우공업 | 141행 × 35열 | 0개 | - |
| 풍기산업 | 56행 × 34열 | 0개 | - |
| 다인 | 21행 × 34열 | 0개 | - |
| 최신단가 | 244행 × 20열 | - | 품목코드 컬럼 없음 |

### Excel 재고 컬럼 구조

- **품목코드 컬럼**: 11-12번 열 (품번)
- **재고 컬럼**: 6번 열 (마감수량)
- **헤더 행**: 3-4행

---

## 📊 통계 분석

### 재고 불일치 유형별 분류

```
총 41개 음수 재고 품목
├── Excel 발견 (32개, 78.0%)
│   ├── 재고 0 (26개, 81.3%)
│   ├── 재고 있음 (3개, 9.4%)
│   └── 정보 없음 (3개, 9.4%)
└── Excel 미발견 (9개, 22.0%)
```

### DB 음수 재고 합계

| 카테고리 | 품목 수 | 총 음수 재고 |
|---------|---------|-------------|
| Excel 발견 (재고 0) | 26개 | **-344,102** |
| Excel 발견 (재고 있음) | 3개 | **-39,650** |
| Excel 발견 (정보 없음) | 3개 | **-34,115** |
| Excel 미발견 | 9개 | **-74,424** |
| **전체** | **41개** | **-492,291** |

**Excel 발견 재고**:
- 65175-L1000: 10,380
- 65185-L1000: 10,380
- 81836-R0600: 8,160 (한 행에만 있음, 다른 행은 0)
- **합계**: **28,920개**

**차이**: Excel 재고 28,920 vs DB 음수 -492,291 = **-463,371개 부족**

---

## 💡 원인 분석

### 가설 1: BOM 파일은 생산 계획서, 실제 재고 아님 ✅

**증거**:
- BOM 파일명: "태창금속 BOM.xlsx"
- 시트명: 고객사별 (호원오토, 인알파코리아, 대우공업 등)
- 대부분 재고가 0 또는 일부만 있음
- **결론**: BOM은 고객사별 제품 구성 명세서이지, 실제 재고 대장이 아님

### 가설 2: 실제 재고는 다른 Excel 파일에 있음 ✅

**근거**:
- 파일 "2025년 9월 종합관리 SHEET.xlsx" 존재
- "종합재고" 시트 존재하나 COIL 재고만 포함 (부품 아님)
- **필요**: 부품 재고가 기록된 별도 파일 찾기

### 가설 3: DB 초기 재고 미설정 ✅

**증거**:
- 대부분 품목이 음수 재고 (26개가 정확히 -6,396, 패턴 발견)
- 거래 기록은 있으나 초기 재고 0으로 시작
- **결론**: 품목 등록 시 `current_stock = 0`으로 초기화됨

### 가설 4: Excel의 일부 재고 값은 임시 또는 계획 수량 ❓

**의문점**:
- 81836-R0600가 2개 행에 나타남 (한 행은 8,160, 다른 행은 0)
- 65175-L1000, 65185-L1000만 10,380개 동일
- **추가 확인 필요**: 이 재고 값의 의미 (실제 재고? 주문 수량? 생산 계획?)

---

## ✅ 해결 방안

### Step 1: 실제 부품 재고 파일 확인 (최우선)

**액션**:
1. "2025년 9월 종합관리 SHEET.xlsx" 전체 시트 재확인
2. 다른 Excel 파일 존재 여부 확인 (예: "부품 재고.xlsx", "원자재 재고.xlsx")
3. 사용자에게 실제 부품 재고를 관리하는 파일 위치 확인

**예상 파일명**:
- 원자재 재고 관리.xlsx
- 부품 재고 현황.xlsx
- 월별 재고 현황.xlsx

### Step 2: DB 초기 재고 설정 방안 결정

**Option A: Excel 재고를 신뢰 (실제 재고 파일 발견 시)**
```sql
-- Excel에서 읽은 실제 재고로 업데이트
UPDATE items
SET current_stock = [Excel 재고 값]
WHERE item_code = '[품목코드]';
```

**Option B: 재고 0으로 초기화 (임시 조치)**
```sql
-- 음수 재고를 0으로 리셋
UPDATE items
SET current_stock = 0
WHERE current_stock < 0;
```

**Option C: 거래 내역 재계산 (정확하지만 복잡)**
```sql
-- inventory_transactions 테이블 기반 재계산
WITH stock_calc AS (
  SELECT
    item_id,
    SUM(CASE
      WHEN transaction_type = '입고' THEN quantity
      WHEN transaction_type = '생산' THEN quantity
      WHEN transaction_type = '출고' THEN -quantity
      ELSE 0
    END) as calculated_stock
  FROM inventory_transactions
  GROUP BY item_id
)
UPDATE items
SET current_stock = stock_calc.calculated_stock
FROM stock_calc
WHERE items.item_id = stock_calc.item_id;
```

### Step 3: 미발견 9개 품목 추가 조사

**액션**:
1. 다른 Excel 파일에서 검색
2. 품목코드 변경 이력 확인 (예: 65264-**F**6000 vs 65264-**R**6000)
3. 사용자에게 품목 폐기 여부 확인

### Step 4: Excel 재고 값 검증

**81836-R0600 중복 행 확인**:
- 행 200: 8,160 (실제 재고?)
- 행 201: 0 (소진?)

**65175-L1000, 65185-L1000 동일 수량 확인**:
- 둘 다 10,380개 → 로트 생산 또는 대칭 부품일 가능성

---

## 📋 다음 액션 아이템

### 즉시 실행 (Critical)
1. ✅ **COMPLETED**: Excel BOM에서 41개 품목 검색 완료
2. ✅ **COMPLETED**: Excel vs DB 재고 비교 완료
3. ⏳ **PENDING**: 실제 부품 재고 파일 위치 확인
4. ⏳ **PENDING**: "2025년 9월 종합관리 SHEET.xlsx" 모든 시트 재분석

### 단기 실행 (1주)
5. ⏳ **PENDING**: 실제 재고 파일 발견 시 데이터 추출
6. ⏳ **PENDING**: 재고 동기화 방법 결정 (Option A/B/C 중 선택)
7. ⏳ **PENDING**: 재고 수정 SQL 스크립트 작성 및 실행

### 중기 실행 (2주)
8. ⏳ **PENDING**: inventory_transactions 검증
9. ⏳ **PENDING**: 미발견 9개 품목 추가 조사
10. ⏳ **PENDING**: 재고 관리 프로세스 정립

---

## 🎯 권고사항

### 1. BOM 파일은 재고 관리 용도 아님

**근거**:
- BOM (Bill of Materials) = 제품 구성 명세서
- 고객사별 제품 구성 정보 포함
- 재고 컬럼은 있으나 대부분 0 또는 임시 값

**결론**: 실제 부품 재고를 관리하는 별도 파일이 필요함

### 2. 실제 재고 파일 우선 확인

**이유**:
- Excel "종합재고" 시트는 COIL만 포함
- 부품 재고는 다른 시트 또는 다른 파일에 있을 가능성 높음
- 정확한 재고 동기화를 위해 실제 재고 파일 필수

### 3. 단계적 접근

**우선순위**:
1. **최우선**: 실제 부품 재고 파일 찾기
2. **다음**: Excel 재고와 DB 동기화
3. **최종**: 재고 관리 프로세스 정립

---

**분석 완료**: 2025-11-05
**다음 단계**: 실제 부품 재고 파일 위치 확인 및 데이터 추출
