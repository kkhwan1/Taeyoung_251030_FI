# 엑셀 실무데이터 누락 항목 추가 계획

**작성일**: 2025-11-05  
**기준**: 분석 리포트 및 DB 상태 확인 결과

---

## 현재 DB 상태

- **Items**: 749개 (price 누락 302개, spec 누락 529개)
- **BOM**: 347개
- **Purchase Transactions**: 40개 (9월 데이터 확인 필요)
- **Sales Transactions**: 53개 (9월 데이터 확인 필요)

---

## 분석 결과 요약

### 엑셀 파일 분석 완료
1. **태창금속 BOM.xlsx**: 6개 시트, 840행 (BOM + 최신단가)
2. **2025년 9월 매입매출 보고현황.xlsx**: 18개 시트, 2,170행
3. **09월 원자재 수불관리.xlsx**: 21개 시트, 972행
4. **2025년 9월 종합관리 SHEET.xlsx**: COIL/SHEET 원자재

### 발견된 누락 데이터 영역

1. **BOM 데이터**: 엑셀 596행 vs DB 347개 (약 249개 누락 가능)
2. **가격 정보**: 엑셀 최신단가 시트 vs DB price (302개 누락)
3. **스펙 정보**: 엑셀 BOM vs DB spec (529개 누락)
4. **매입/매출 거래**: 엑셀 9월 데이터 vs DB (9월 데이터 확인 필요)

---

## 작업 계획

### Phase 1: 엑셀 데이터 추출 및 비교 (예상 시간: 2-3시간)

#### 1.1 BOM 데이터 추출 및 비교
- **파일**: `태창금속 BOM.xlsx`
- **대상 시트**: 대우공업, 풍기산업, 다인, 호원오토, 인알파코리아
- **작업**:
  1. 각 시트에서 BOM 관계 추출 (parent_item_code, child_item_code, quantity_required)
  2. DB 기존 BOM과 비교하여 중복 제외
  3. 새로운 BOM 관계 식별
  4. 품목 코드 매칭 확인 (DB items 테이블과 비교)

#### 1.2 가격 정보 추출
- **파일**: `태창금속 BOM.xlsx` - "최신단가" 시트
- **작업**:
  1. 최신단가 시트에서 품목코드, 단가 추출
  2. DB items 테이블과 매칭 (item_code 기준)
  3. price가 NULL 또는 0인 품목 식별
  4. 엑셀 가격 정보로 업데이트 대상 리스트 생성

#### 1.3 스펙 정보 추출
- **파일**: `태창금속 BOM.xlsx` - 각 BOM 시트
- **작업**:
  1. 각 BOM 시트에서 품목 스펙 정보 추출 (규격 컬럼)
  2. DB items 테이블과 매칭
  3. spec이 NULL 또는 빈 값인 품목 식별

#### 1.4 매입/매출 거래 추출
- **파일**: `2025년 9월 매입매출 보고현황.xlsx`
- **작업**:
  1. 각 시트에서 매입/매출 거래 데이터 추출
  2. 9월 데이터 (2025-09-01 ~ 2025-09-30) 필터링
  3. DB purchase_transactions, sales_transactions와 비교
  4. 중복 제외한 새로운 거래 식별

---

### Phase 2: 데이터 추가 스크립트 작성 (예상 시간: 3-4시간)

#### 2.1 BOM 추가 스크립트
- **파일**: `scripts/add-missing-bom-data.ts`
- **기능**:
  - 엑셀에서 추출한 BOM 데이터를 DB에 추가
  - 중복 체크 (parent_item_id, child_item_id 조합)
  - 품목 코드 → item_id 매핑
  - 트랜잭션 처리 (롤백 가능)

#### 2.2 가격 업데이트 스크립트
- **파일**: `scripts/update-item-prices.ts`
- **기능**:
  - 엑셀 최신단가 데이터로 items.price 업데이트
  - 기존 가격이 있는 경우 건너뛰기 (옵션)
  - 업데이트 로그 기록

#### 2.3 스펙 업데이트 스크립트
- **파일**: `scripts/update-item-specs.ts`
- **기능**:
  - 엑셀 BOM 데이터에서 스펙 정보 추출
  - items.spec 업데이트
  - 기존 스펙이 있는 경우 건너뛰기 (옵션)

#### 2.4 매입/매출 거래 추가 스크립트
- **파일**: `scripts/add-purchase-sales-transactions.ts`
- **기능**:
  - 엑셀에서 추출한 9월 매입/매출 거래 추가
  - 중복 체크 (transaction_no 또는 날짜+품목+수량 조합)
  - 거래처 매칭 (company_name → company_id)
  - 품목 매칭 (item_code → item_id)

---

### Phase 3: 데이터 검증 및 실행 (예상 시간: 2-3시간)

#### 3.1 사전 검증
- 엑셀 데이터 품질 확인
- DB 제약 조건 확인
- 외래키 무결성 확인

#### 3.2 스크립트 실행
- 단계별 실행 (BOM → 가격 → 스펙 → 거래)
- 각 단계마다 결과 확인
- 오류 발생 시 롤백

#### 3.3 사후 검증
- 추가된 데이터 건수 확인
- 데이터 무결성 검증
- 리포트 생성

---

### Phase 4: 결과 리포트 생성 (예상 시간: 1시간)

#### 4.1 추가 결과 리포트
- **파일**: `analysis/reports/DATA_ADDITION_REPORT.md`
- **내용**:
  - 추가된 BOM 건수
  - 업데이트된 가격 건수
  - 업데이트된 스펙 건수
  - 추가된 매입/매출 거래 건수
  - 오류 및 경고 사항

---

## 예상 결과

### 추가될 데이터
- **BOM**: 약 100-200개 (중복 제외 후)
- **가격 정보**: 약 100-200개 품목 업데이트
- **스펙 정보**: 약 200-300개 품목 업데이트
- **매입/매출 거래**: 9월 데이터 추가 (건수 확인 필요)

---

## 주의사항

### ⚠️ 중복 방지
- 모든 추가 작업 전 중복 체크 필수
- 기존 데이터 덮어쓰기 방지

### ⚠️ 데이터 백업
- 작업 전 DB 백업 필수
- 각 단계별 롤백 가능하도록 트랜잭션 처리

### ⚠️ 단계별 실행
- 한 번에 모든 데이터 추가하지 말고 단계별로 진행
- 각 단계마다 검증 수행

---

## 우선순위

### High Priority
1. **BOM 데이터 추가** (기능적 중요도 높음)
2. **가격 정보 업데이트** (비즈니스 중요도 높음)

### Medium Priority
3. **스펙 정보 업데이트** (데이터 완성도 향상)
4. **매입/매출 거래 추가** (히스토리 보완)

---

## 다음 단계

1. **엑셀 데이터 추출 스크립트 작성** (Python/Node.js)
2. **DB와 비교하여 누락 항목 식별**
3. **데이터 추가 스크립트 작성**
4. **단계별 실행 및 검증**

