# Phase 6A ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰ ìƒí™©

**ì‘ì„±ì¼**: 2025-01-XX
**ëŒ€ìƒ**: 2025ë…„ 9ì›” ë§¤ì…ë§¤ì¶œ ê±°ë˜ ë°ì´í„°

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ: ì¤€ë¹„ ì™„ë£Œ (Ready for Full Import)

### âœ… ì™„ë£Œëœ ì‘ì—…

#### 1. í™˜ê²½ ì„¤ì • ë° ê²€ì¦
- [x] Windows ê²½ë¡œ ë¬¸ì œ í•´ê²°
- [x] .env í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
- [x] Supabase ì—°ê²° í…ŒìŠ¤íŠ¸
- [x] npm ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (`migrate:p6a`, `migrate:p6a-test`)

#### 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¸
- [x] `company_type` enum ê°’: `'ê³ ê°ì‚¬'`, `'ê³µê¸‰ì‚¬'` í™•ì¸
- [x] `items.category` NOT NULL ì œì•½ í™•ì¸ â†’ ê¸°ë³¸ê°’ `'ìƒí’ˆ'` ì„¤ì •
- [x] ê±°ë˜ í…Œì´ë¸” êµ¬ì¡° ê²€ì¦

#### 3. Excel ë°ì´í„° êµ¬ì¡° ë¶„ì„
- [x] **ë‚©í’ˆìˆ˜ëŸ‰(ì˜ì—…)** ì‹œíŠ¸ (386í–‰ Ã— 107ì—´)
  - ì—´ êµ¬ì¡°: A(ë¶„ë¥˜), B(ê³ ê°ì‚¬), C(í’ˆë²ˆ), D(í’ˆëª…), E(ì°¨ì¢…), F(ë‹¨ê°€), G~(ì¼ë³„ ìˆ˜ëŸ‰)
  - ë°ì´í„° í˜•íƒœ: ì¼ë³„ ìˆ˜ëŸ‰ì´ ì—´ ë°©í–¥ìœ¼ë¡œ í¼ì³ì§„ pivot í˜•íƒœ

- [x] **ë§¤ì…ë¶€ìì¬(êµ¬ë§¤)** ì‹œíŠ¸ (241í–‰ Ã— 148ì—´)
  - ì—´ êµ¬ì¡°: A(ë¶„ë¥˜), B(ì–‘ì‚°ì²˜), C(í˜‘ë ¥ì‚¬), D(NO), E(ì–‘ì‚°ì²˜2), F(ì°¨ì¢…), G(í’ˆë²ˆ), H(í’ˆëª…), I(ë‹¨ê°€), J~(ì¼ë³„ ìˆ˜ëŸ‰)

#### 4. ë°ì´í„° ë³€í™˜ ë¡œì§ ê°œë°œ
- [x] ë§¤ì¶œ ê±°ë˜ íŒŒì‹± í•¨ìˆ˜ (`parseSalesRow`)
- [x] ë§¤ì… ê±°ë˜ íŒŒì‹± í•¨ìˆ˜ (`parsePurchaseRow`)
- [x] ì¼ë³„ ìˆ˜ëŸ‰ â†’ ê°œë³„ ê±°ë˜ ë ˆì½”ë“œ ë³€í™˜ ë¡œì§
- [x] ê¸ˆì•¡ ìë™ ê³„ì‚° (ê³µê¸‰ê°€ì•¡, ì„¸ì•¡, í•©ê³„)

#### 5. ìë™ ë°ì´í„° ìƒì„± ê¸°ëŠ¥
- [x] ê±°ë˜ì²˜ ìë™ ìƒì„± (`getOrCreateCompany`)
  - ì—†ëŠ” ê±°ë˜ì²˜ëŠ” ìë™ìœ¼ë¡œ ìƒì„±
  - company_code = company_name ë™ì¼í•˜ê²Œ ì„¤ì •
  - ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€

- [x] í’ˆëª© ìë™ ìƒì„± (`getOrCreateItem`)
  - ì—†ëŠ” í’ˆëª©ì€ ìë™ìœ¼ë¡œ ìƒì„±
  - category = 'ìƒí’ˆ' ê¸°ë³¸ê°’
  - ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€

#### 6. ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [x] ë§¤ì¶œ ê±°ë˜ 3ê±´ import ì„±ê³µ
- [x] ë§¤ì… ê±°ë˜ 2ê±´ import ì„±ê³µ
- [x] ê±°ë˜ì²˜ 2ê°œ ìë™ ìƒì„± (í˜¸ì›ì˜¤í† , ëŒ€ìš°ì‚¬ê¸‰)
- [x] í’ˆëª© 1ê°œ ìë™ ìƒì„± (65131-L2500)
- [x] ì—ëŸ¬ 0ê±´

---

## ğŸ“‹ ë°ì´í„° í˜„í™©

### Excel ì›ë³¸ ë°ì´í„°
```
íŒŒì¼: 2025ë…„ 9ì›” ë§¤ì…ë§¤ì¶œ ë³´ê³ í˜„í™©.xlsx

1. ë‚©í’ˆìˆ˜ëŸ‰(ì˜ì—…) ì‹œíŠ¸
   - ì´ í–‰ìˆ˜: 386í–‰
   - ì˜ˆìƒ ê±°ë˜ ê±´ìˆ˜: ~3,860ê±´ (386í–‰ Ã— í‰ê·  10ì¼)

2. ë§¤ì…ë¶€ìì¬(êµ¬ë§¤) ì‹œíŠ¸
   - ì´ í–‰ìˆ˜: 241í–‰
   - ì˜ˆìƒ ê±°ë˜ ê±´ìˆ˜: ~2,410ê±´ (241í–‰ Ã— í‰ê·  10ì¼)

ì´ ì˜ˆìƒ ê±°ë˜: ~6,270ê±´
```

### DB í˜„ì¬ ìƒíƒœ
```
sales_transactions (2025-09): 3ê±´ (ìƒ˜í”Œ í…ŒìŠ¤íŠ¸)
purchase_transactions (2025-09): 2ê±´ (ìƒ˜í”Œ í…ŒìŠ¤íŠ¸)
companies: +2ê±´ (í˜¸ì›ì˜¤í† , ëŒ€ìš°ì‚¬ê¸‰)
items: +1ê±´ (65131-L2500)
```

---

## ğŸ”§ êµ¬í˜„ëœ ìŠ¤í¬ë¦½íŠ¸

### 1. phase6a-import-transactions.js
**ìœ„ì¹˜**: `scripts/migration/phase6a-import-transactions.js`
**ê¸°ëŠ¥**: ë©”ì¸ import ìŠ¤í¬ë¦½íŠ¸

**ì£¼ìš” í•¨ìˆ˜**:
- `createTransactionDate(year, month, day)` - ë‚ ì§œ ìƒì„±
- `generateTransactionNo(type, date, sequence)` - ê±°ë˜ë²ˆí˜¸ ìƒì„±
- `getOrCreateCompany(companyCode, companyType)` - ê±°ë˜ì²˜ ì¡°íšŒ/ìƒì„±
- `getOrCreateItem(itemCode, itemName)` - í’ˆëª© ì¡°íšŒ/ìƒì„±
- `parseSalesRow(row, year, month)` - ë§¤ì¶œ ê±°ë˜ íŒŒì‹±
- `parsePurchaseRow(row, year, month)` - ë§¤ì… ê±°ë˜ íŒŒì‹±
- `saveSalesTransaction(transaction, sequence)` - ë§¤ì¶œ ì €ì¥
- `savePurchaseTransaction(transaction, sequence)` - ë§¤ì… ì €ì¥
- `printStats()` - í†µê³„ ì¶œë ¥

**ì‚¬ìš©ë²•**:
```bash
# ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ (5ê±´)
npm run migrate:p6a-test

# ì „ì²´ import (ë¯¸êµ¬í˜„)
npm run migrate:p6a -- --full
```

### 2. phase6a-excel-reader.js
**ìœ„ì¹˜**: `scripts/migration/phase6a-excel-reader.js`
**ê¸°ëŠ¥**: Excel MCPë¥¼ í†µí•œ ë°ì´í„° ì½ê¸° ìœ í‹¸ë¦¬í‹° (í”Œë ˆì´ìŠ¤í™€ë”)

---

## âš ï¸ ë‚¨ì€ ì‘ì—…

### í•„ìˆ˜ ì‘ì—…
1. **ì „ì²´ ë°ì´í„° ì½ê¸° êµ¬í˜„**
   - Excel MCP ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ì‹œíŠ¸ ë°ì´í„° ì½ê¸°
   - ë°°ì¹˜ ì²˜ë¦¬ (50-100í–‰ì”©)
   - ì§„í–‰ë¥  í‘œì‹œ

2. **ì „ì²´ import ì‹¤í–‰**
   - ë‚©í’ˆìˆ˜ëŸ‰(ì˜ì—…) ì‹œíŠ¸ â†’ sales_transactions
   - ë§¤ì…ë¶€ìì¬(êµ¬ë§¤) ì‹œíŠ¸ â†’ purchase_transactions
   - ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡¤ë°± ì „ëµ

3. **ë°ì´í„° ê²€ì¦**
   - importëœ ê±°ë˜ ê±´ìˆ˜ í™•ì¸
   - ê¸ˆì•¡ í•©ê³„ ê²€ì¦ (Excel vs DB)
   - ëˆ„ë½ëœ ë‚ ì§œ/í’ˆëª© í™•ì¸

### ì„ íƒ ì‘ì—…
- [ ] ì¤‘ë³µ ê±°ë˜ ë°©ì§€ ë¡œì§ (transaction_no ì¤‘ë³µ ì²´í¬)
- [ ] import ë¡œê·¸ íŒŒì¼ ìƒì„±
- [ ] ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

```bash
# 1. ì „ì²´ ë°ì´í„° ì½ê¸° êµ¬í˜„ (Excel MCP ì‚¬ìš©)
# 2. ì „ì²´ import ì‹¤í–‰
npm run migrate:p6a -- --full

# 3. ê²€ì¦
node -e "
require('dotenv').config();
const { createClient } = require('@supabase/supabase-js');
const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);

async function verify() {
  const { count: sales } = await supabase.from('sales_transactions').select('*', { count: 'exact', head: true }).gte('transaction_date', '2025-09-01').lte('transaction_date', '2025-09-30');
  const { count: purchase } = await supabase.from('purchase_transactions').select('*', { count: 'exact', head: true }).gte('transaction_date', '2025-09-01').lte('transaction_date', '2025-09-30');
  console.log('Sales:', sales, 'Purchase:', purchase);
}
verify();
"
```

---

## ğŸ“ ì¤‘ë‹¨ ì‹œì  ìš”ì•½

**ì¤‘ë‹¨ ì´ìœ **: íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•œ ì¼ì‹œ ì¤‘ë‹¨

**ì¬ê°œ ë°©ë²•**:
1. Excel MCPë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ë°ì´í„° ì½ê¸° ë¡œì§ ì™„ì„±
2. `--full` ëª¨ë“œ êµ¬í˜„
3. ì‹¤í–‰ ë° ê²€ì¦

**í˜„ì¬ ìƒíƒœ**: ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ ì„±ê³µ, ì „ì²´ import ì¤€ë¹„ ì™„ë£Œ âœ…

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**:
- ì „ì²´ ë°ì´í„° ì½ê¸° êµ¬í˜„: 30ë¶„
- ì „ì²´ import ì‹¤í–‰: 10-15ë¶„
- ê²€ì¦ ë° ë¬¸ì„œí™”: 10ë¶„

**ì´ ì˜ˆìƒ ì‹œê°„**: ì•½ 1ì‹œê°„
