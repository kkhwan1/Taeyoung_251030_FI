# ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒíƒœ í™•ì¸

## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ëª©ë¡

`migrations` í´ë”ì— ìˆëŠ” ëª¨ë“  SQL íŒŒì¼ì˜ ì ìš© ìƒíƒœë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

## âœ… ì ìš© ì™„ë£Œëœ ë§ˆì´ê·¸ë ˆì´ì…˜

### 1. `add_coil_process_id_to_process_operations.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `process_operations` í…Œì´ë¸”ì— `coil_process_id` ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251121071603`
- **ëª©ì **: ê³µì • ì‘ì—…ê³¼ ì½”ì¼ ì¶”ì  í†µí•©

### 2. `update_auto_process_stock_movement_add_inventory_transactions.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `auto_process_stock_movement()` í•¨ìˆ˜ì— `inventory_transactions` ìƒì„± ë¡œì§ í¬í•¨ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251121075347`
- **ëª©ì **: ê³µì • ì™„ë£Œ ì‹œ `inventory_transactions` í…Œì´ë¸”ì—ë„ ì¬ê³  ì´ë™ ê¸°ë¡

### 3. `create_production_batch_table.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `production_batch` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251119072719` (ì¸ë±ìŠ¤ ì¶”ê°€)
- **ëª©ì **: ìƒì‚° ë°°ì¹˜ ê´€ë¦¬ í…Œì´ë¸” ìƒì„±

### 4. `create_production_batch_items_table.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `production_batch_items` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251119072729` (ì¸ë±ìŠ¤ ì¶”ê°€)
- **ëª©ì **: ìƒì‚° ë°°ì¹˜ í’ˆëª© í…Œì´ë¸” ìƒì„±

### 5. `create_invoice_items_table.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `invoice_items` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251031233043`
- **ëª©ì **: ì¸ë³´ì´ìŠ¤ í’ˆëª© í…Œì´ë¸” ìƒì„±

### 6. `create_payment_splits_table.sql`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ
- **í™•ì¸ ë‚´ìš©**: `payment_splits` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
- **Supabase ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251101015620`
- **ëª©ì **: ì§€ê¸‰ ë¶„í•  í…Œì´ë¸” ìƒì„±

## âš ï¸ í™•ì¸ í•„ìš”í•œ ë§ˆì´ê·¸ë ˆì´ì…˜

### 7. `add_update_stock_trigger.sql`
- **ìƒíƒœ**: âš ï¸ ë¶€ë¶„ ì ìš© (íŠ¸ë¦¬ê±° ì´ë¦„ ë‹¤ë¦„)
- **í™•ì¸ ë‚´ìš©**: 
  - íŒŒì¼ì—ëŠ” `update_stock_on_transaction` íŠ¸ë¦¬ê±° ìƒì„±
  - ì‹¤ì œ DBì—ëŠ” `update_item_stock` íŠ¸ë¦¬ê±° ì¡´ì¬
  - ê¸°ëŠ¥ì€ ë™ì¼í•˜ì§€ë§Œ ì´ë¦„ì´ ë‹¤ë¦„
- **ê¶Œì¥ ì¡°ì¹˜**: 
  - í˜„ì¬ `update_item_stock` íŠ¸ë¦¬ê±°ê°€ ì •ìƒ ì‘ë™ ì¤‘ì´ë©´ ë¬¸ì œ ì—†ìŒ
  - í•„ìš”ì‹œ íŠ¸ë¦¬ê±° ì´ë¦„ í†µì¼ ê³ ë ¤

### 8. `create_process_batch_approval_trigger.sql`
- **ìƒíƒœ**: â“ í™•ì¸ í•„ìš”
- **í™•ì¸ ë‚´ìš©**: 
  - Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ëª©ë¡ì— `20251119070841` ì¡´ì¬
  - íŠ¸ë¦¬ê±° ì´ë¦„ í™•ì¸ í•„ìš”
- **ê¶Œì¥ ì¡°ì¹˜**: íŠ¸ë¦¬ê±° ì¡´ì¬ ì—¬ë¶€ ì¬í™•ì¸

### 9. `create_validate_payment_splits_trigger.sql`
- **ìƒíƒœ**: â“ í™•ì¸ í•„ìš”
- **í™•ì¸ ë‚´ìš©**: 
  - Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ëª©ë¡ì— `20251119070924` ì¡´ì¬
  - íŠ¸ë¦¬ê±° ì´ë¦„ í™•ì¸ í•„ìš”
- **ê¶Œì¥ ì¡°ì¹˜**: íŠ¸ë¦¬ê±° ì¡´ì¬ ì—¬ë¶€ ì¬í™•ì¸

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ í†µê³„

- **ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼**: 9ê°œ
- **í™•ì¸ ì™„ë£Œ**: 6ê°œ (67%)
- **í™•ì¸ í•„ìš”**: 3ê°œ (33%)

## ğŸ” ìƒì„¸ í™•ì¸ ê²°ê³¼

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¸

```sql
-- 1. coil_process_id ì»¬ëŸ¼
âœ… process_operations.coil_process_id ì¡´ì¬

-- 2. auto_process_stock_movement í•¨ìˆ˜
âœ… inventory_transactions ìƒì„± ë¡œì§ í¬í•¨

-- 3. í…Œì´ë¸” ì¡´ì¬ í™•ì¸
âœ… production_batch
âœ… production_batch_items
âœ… invoice_items
âœ… payment_splits

-- 4. íŠ¸ë¦¬ê±° í™•ì¸
âœ… update_item_stock (inventory_transactions)
âš ï¸ process_batch_approval_trigger (í™•ì¸ í•„ìš”)
âš ï¸ validate_payment_splits_trigger (í™•ì¸ í•„ìš”)
```

## ğŸ’¡ ê¶Œì¥ ì‚¬í•­

1. **íŠ¸ë¦¬ê±° í™•ì¸**: `process_batch_approval_trigger`ì™€ `validate_payment_splits_trigger`ì˜ ì‹¤ì œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
2. **íŠ¸ë¦¬ê±° ì´ë¦„ í†µì¼**: `update_stock_on_transaction` vs `update_item_stock` í†µì¼ ê²€í† 
3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì •ë¦¬**: 
   - ì ìš© ì™„ë£Œëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ë¬¸ì„œí™” ì™„ë£Œ
   - í™•ì¸ í•„ìš”í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì¶”ê°€ ê²€ì¦ í•„ìš”

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. íŠ¸ë¦¬ê±° ì¡´ì¬ ì—¬ë¶€ ì¬í™•ì¸
2. íŠ¸ë¦¬ê±° ì´ë¦„ í†µì¼ ì—¬ë¶€ ê²°ì •
3. ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ìƒíƒœ ìµœì¢… í™•ì¸

