# 태창 ERP - Excel 파일 및 데이터베이스 종합 분석 리포트

**분석 일시**: 2025-02-01
**분석 대상**: 4개 Excel 파일, Supabase PostgreSQL 데이터베이스 (TAECHANG_ERP)

---

## 📊 Executive Summary

### Excel 파일 분석 결과
- **총 파일 수**: 4개
- **총 시트 수**: 50개
- **총 수식 수**: 135,377개
- **총 시트 간 참조**: 72,737개

### 데이터베이스 현황
- **총 테이블 수**: 37개
- **데이터 보유 테이블**: 12개
- **빈 테이블**: 5개 (warehouses, warehouse_stock, stock_adjustments, contracts, coil_specs)
- **데이터 희박 테이블**: 5개 (production_batch, collections, payments, invoice_items, production_batch_items)

---

## 🔍 상세 분석

### 1. Excel 파일별 분석

#### 📁 2025년 9월 종합관리 SHEET.xlsx
**목적**: 종합 재고 및 생산 관리
**시트 수**: 5개
**총 수식**: 13,973개
**시트간 참조**: 4,754개

**핵심 시트**:
1. **종합재고** (392행)
   - 재고 현황 종합 관리
   - 221개 수식 (주로 SUMIF, VLOOKUP)
   - 132개 시트 간 참조

2. **SHEET 입고현황** (380행) ⭐ 가장 복잡
   - 7,357개 수식 (가장 많음)
   - 4,487개 시트 간 참조
   - 입고 거래 상세 추적

3. **COIL 입고현황** (388행)
   - 2,888개 수식
   - Coil 형태 원자재 입고 관리

4. **생산실적** (95행)
   - 3,474개 수식
   - 135개 시트 간 참조
   - 일일 생산 실적 집계

**DB 매핑 가능성**:
- `inventory_transactions` (입고/출고) ✅ 부분 매핑됨
- `production_batch` ⚠️ 희박 (2건) - 대량 데이터 필요
- `warehouse_stock` ❌ 빈 테이블 - 전체 이관 필요

---

#### 📁 태창금속 BOM.xlsx
**목적**: 고객사별 BOM 마스터 데이터
**시트 수**: 6개
**총 수식**: 3,096개
**시트간 참조**: 400개

**핵심 시트**:
1. **대우공업** (857행)
   - 440개 수식, 113개 참조
   - 대우공업 납품 BOM

2. **풍기산업** (889행)
   - 183개 수식, 35개 참조

3. **호원오토** (791행)
   - 1,498개 수식, 182개 참조

4. **인알파코리아** (873행)
   - 891개 수식, 70개 참조

5. **최신단가** (250행) ⭐ 중요
   - 수식 없음 (순수 데이터)
   - 품목별 최신 단가 테이블

**DB 매핑 가능성**:
- `bom` ✅ 잘 매핑됨 (347건)
- `price_master` ✅ 잘 매핑됨 (228건)
- `customer_bom_templates` ⚠️ 고객사별 템플릿 필요

---

#### 📁 09월 원자재 수불관리.xlsx ⭐ 가장 복잡한 파일
**목적**: 원자재 입출고 및 재고 관리
**시트 수**: 21개
**총 수식**: 13,631개
**시트간 참조**: 9,628개

**핵심 시트**:
1. **태창금속 (전착도장)** (377행) ⭐ 초복잡
   - 7,133개 수식
   - 4,685개 시트 간 참조
   - 전착도장 공정 재고 관리

2. **인알파 (주간계획)** (186행)
   - 3,863개 수식
   - 3,780개 시트 간 참조 (거의 모든 셀이 참조!)
   - 주간 생산 계획 수립

3. **실적 취합** (417행)
   - 777개 수식
   - 373개 참조
   - 모든 실적 데이터 집계

4. **협력업체 시트들** (20개 시트)
   - 각 협력사별 입고 현황 추적
   - 사급 거래 관리

**DB 매핑 가능성**:
- `inventory_transactions` ✅ 부분 매핑 (2,043건)
- `companies` ✅ 협력사 데이터 (95건)
- `production_batch` ⚠️ 주간계획 데이터 필요

---

#### 📁 2025년 9월 매입매출 보고현황.xlsx ⭐ 수식 최다
**목적**: 매입/매출 거래 및 일일 보고
**시트 수**: 18개
**총 수식**: 104,677개 (전체의 77%!)
**시트간 참조**: 57,955개

**핵심 시트**:
1. **납품수량(영업)** (385행) ⭐ 수식 최다
   - 25,192개 수식 (단일 시트 최다!)
   - 12,113개 시트 간 참조
   - 일일 납품 수량 집계

2. **종합 일일매출 보고용** (567행)
   - 17,506개 수식
   - 8,632개 참조
   - 전체 매출 종합 보고

3. **매입부자재(구매)** (240행)
   - 10,658개 수식
   - 4,942개 참조

4. **인알파** (353행)
   - 10,705개 수식
   - 5,365개 참조
   - 인알파코리아 거래 상세

5. **협력사** (204행)
   - 9,737개 수식
   - 9,737개 참조 (모든 셀이 참조!)

**DB 매핑 가능성**:
- `sales_transactions` ⚠️ 희박 (53건) - 대량 추가 필요
- `purchase_transactions` ⚠️ 희박 (40건) - 대량 추가 필요
- `collections` ⚠️ 매우 희박 (2건)
- `payments` ⚠️ 매우 희박 (2건)

---

## 🎯 데이터베이스 현황 상세

### 데이터 보유 테이블 (12개)

| 테이블 | 레코드 수 | 상태 | Excel 매핑 |
|--------|-----------|------|------------|
| inventory_transactions | 2,043 | 🟢 양호 | 종합관리 SHEET, 원자재 수불 |
| items | 749 | 🟢 양호 | BOM, 최신단가 |
| bom | 347 | 🟢 양호 | 태창금속 BOM |
| price_master | 228 | 🟢 양호 | 최신단가 |
| companies | 95 | 🟢 양호 | 협력사 시트들 |
| sales_transactions | 53 | 🟡 희박 | 매입매출 보고 - 납품수량 |
| purchase_transactions | 40 | 🟡 희박 | 매입매출 보고 - 매입부자재 |
| production_batch_items | 3 | 🔴 매우 희박 | 생산실적, 주간계획 |
| payments | 2 | 🔴 매우 희박 | 매입매출 보고 - 정리 |
| collections | 2 | 🔴 매우 희박 | 매입매출 보고 - 정리 |
| production_batch | 2 | 🔴 매우 희박 | 생산실적 |
| invoice_items | 1 | 🔴 매우 희박 | - |

### 빈 테이블 (5개)

| 테이블 | 레코드 수 | Excel 매핑 가능성 |
|--------|-----------|-------------------|
| warehouses | 0 | ⚠️ 기준 정보 필요 (창고 코드/위치) |
| warehouse_stock | 0 | ✅ 종합재고 시트 매핑 가능 |
| stock_adjustments | 0 | ✅ 재고 조정 내역 매핑 가능 |
| contracts | 0 | ⚠️ Excel에 계약 정보 없음 |
| coil_specs | 0 | ✅ COIL 입고현황 매핑 가능 |

---

## 🔗 Excel-DB 매핑 상세 분석

### 1. 품목 마스터 (items) ✅ 잘 매핑됨
**Excel 소스**: 태창금속 BOM.xlsx - 모든 시트
**현재 상태**: 749건
**예상 증가**: +100~200건 (Excel에만 있는 품목)

**매핑 컬럼**:
- `item_code` ← Excel: 품번/품목코드
- `item_name` ← Excel: 품명
- `spec` ← Excel: 규격/사양
- `unit_price` ← Excel: 단가
- `category` ← Excel: 구분(COIL/SHEET)

---

### 2. 거래처 마스터 (companies) ✅ 잘 매핑됨
**Excel 소스**:
- 태창금속 BOM.xlsx (시트명이 고객사명)
- 원자재 수불관리.xlsx (협력사 시트들)

**현재 상태**: 95건
**예상 증가**: +10~20건

**고객사 리스트** (BOM 시트명):
- 대우공업
- 풍기산업
- 다인
- 호원오토
- 인알파코리아

**협력사 리스트** (원자재 수불 시트명):
- 풍기서산, 세원테크, 대우포승, 호원오토
- 웅지테크, 태영금속, JS테크, 에이오에스
- 창경테크, 신성테크, 광성산업

---

### 3. BOM (bill_of_materials) ✅ 잘 매핑됨
**Excel 소스**: 태창금속 BOM.xlsx
**현재 상태**: 347건
**예상 증가**: +500~1,000건

**매핑 로직**:
```
각 고객사 시트별로:
- parent_item_id ← 완제품 품번
- child_item_id ← 원자재 품번
- quantity ← 소요량
- customer_id ← 시트명(고객사명)
```

---

### 4. 단가 마스터 (price_master) ✅ 잘 매핑됨
**Excel 소스**: 태창금속 BOM.xlsx - 최신단가 시트
**현재 상태**: 228건
**예상 증가**: +50~100건

---

### 5. 재고 거래 (inventory_transactions) 🟡 부분 매핑
**Excel 소스**:
- 종합관리 SHEET.xlsx - COIL/SHEET 입고현황
- 원자재 수불관리.xlsx - 협력사별 시트

**현재 상태**: 2,043건
**예상 증가**: +3,000~5,000건 (Excel에 더 많은 이력)

**매핑 필드**:
- `transaction_type` ← '입고'/'출고'/'생산'
- `item_id` ← 품번
- `quantity` ← 수량
- `transaction_date` ← 날짜 컬럼
- `supplier_id` / `customer_id` ← 거래처

---

### 6. 매출 거래 (sales_transactions) 🔴 심각하게 희박
**Excel 소스**: 매입매출 보고현황.xlsx - 납품수량(영업), 종합 일일매출 보고용
**현재 상태**: 53건 ❌
**Excel 데이터**: 567행 (종합 일일매출 보고용)
**예상 증가**: **+500~1,000건**

**⚠️ 우선순위 높음**: 매출 데이터가 심각하게 부족함

---

### 7. 매입 거래 (purchase_transactions) 🔴 심각하게 희박
**Excel 소스**: 매입매출 보고현황.xlsx - 매입부자재(구매)
**현재 상태**: 40건 ❌
**Excel 데이터**: 240행
**예상 증가**: **+200~400건**

**⚠️ 우선순위 높음**: 매입 데이터가 심각하게 부족함

---

### 8. 수금/지급 (collections/payments) 🔴 매우 희박
**Excel 소스**: 매입매출 보고현황.xlsx - 정리 시트
**현재 상태**: 각 2건 ❌
**예상 증가**: +100~200건

---

### 9. 생산 배치 (production_batch) 🔴 매우 희박
**Excel 소스**:
- 종합관리 SHEET.xlsx - 생산실적
- 원자재 수불관리.xlsx - 인알파(주간계획)

**현재 상태**: 2건 ❌
**Excel 데이터**: 95행 (생산실적) + 186행 (주간계획)
**예상 증가**: **+200~300건**

---

### 10. 빈 테이블 분석

#### warehouse_stock (창고별 재고) - 빈 테이블
**Excel 소스**: 종합관리 SHEET.xlsx - 종합재고
**매핑 가능성**: ✅ 높음
**예상 레코드**: 392행 → 400~500건

**매핑 로직**:
```
종합재고 시트의 각 행:
- item_id ← 품번
- warehouse_id ← 창고 위치 (신규 warehouses 테이블 필요)
- current_quantity ← 현재고
- safety_stock ← 안전재고
```

**⚠️ 선행 작업**: `warehouses` 테이블 먼저 채워야 함

---

#### coil_specs (코일 규격) - 빈 테이블
**Excel 소스**: 종합관리 SHEET.xlsx - COIL 입고현황
**매핑 가능성**: ✅ 높음
**예상 레코드**: 100~200건

---

## 📋 웹 미반영 기능 분석

### 1. Excel에만 있는 주요 기능들

#### 🔴 높은 우선순위

1. **주간 생산 계획** (원자재 수불관리 - 인알파 주간계획)
   - 3,863개 수식으로 자동 계산
   - 3,780개 시트 간 참조
   - **웹 반영**: ❌ 없음
   - **권장**: `production_planning` 테이블 신규 생성

2. **실적 취합 대시보드** (원자재 수불관리 - 실적 취합)
   - 777개 수식으로 집계
   - **웹 반영**: 부분 (대시보드 있지만 상세 집계 부족)
   - **권장**: 대시보드 차트 확장

3. **일일 업무 보고** (매입매출 보고 - 일일업무보고)
   - 5,458개 수식
   - 2,414개 참조
   - **웹 반영**: ❌ 없음
   - **권장**: 일일 보고서 자동 생성 기능

4. **물류 관리** (매입매출 보고 - 물류)
   - 918개 수식
   - **웹 반영**: ❌ 없음
   - **권장**: `logistics` 테이블 및 페이지 신규

5. **협력사 매입매출 집계** (매입매출 보고 - 협력사 매입매출)
   - 거래처별 매입/매출 동시 관리
   - **웹 반영**: 부분 (별도 페이지로 분리됨)

---

#### 🟡 중간 우선순위

6. **창고별 재고 관리**
   - Excel: 종합재고 시트로 관리
   - **웹 반영**: ❌ 없음 (warehouse_stock 테이블 빔)
   - **권장**: 창고 관리 모듈 추가

7. **재고 조정 이력**
   - **웹 반영**: ❌ 없음 (stock_adjustments 테이블 빔)
   - **권장**: 재고 조정 기능 구현

8. **계약 관리**
   - **웹 반영**: ❌ 없음 (contracts 테이블 빔)
   - **권장**: 계약서 관리 모듈 추가

---

### 2. Excel 수식으로 구현된 비즈니스 로직

#### SUMIF 계산 로직 (가장 많이 사용)
- 고객사별 합계
- 품목별 합계
- 월별 집계
- 거래처별 집계

**웹 반영**: ✅ PostgreSQL 집계 쿼리로 구현됨

---

#### VLOOKUP 참조 로직
- 품목 정보 조회 (품번 → 품명/규격/단가)
- 거래처 정보 조회
- BOM 정보 조회

**웹 반영**: ✅ JOIN 쿼리로 구현됨

---

#### 시트 간 참조 로직 (72,737개!)
**주요 패턴**:
1. **종합 시트 ← 상세 시트들**
   - 예: 종합재고 ← COIL입고, SHEET입고
   - 예: 정리 ← 태창금속, 협력사

2. **보고서 ← 기초 데이터**
   - 예: 일일매출보고용 ← 납품수량
   - 예: 종합일일매출 ← 호원오토, 대우공업, 인알파

3. **계획 ← 실적 데이터**
   - 예: 주간계획 ← 실적취합

**웹 반영**: 🟡 부분 (대시보드에 일부 집계, 하지만 상세 보고서 부족)

---

## 🚀 데이터 임포트 전략

### Phase 1: 마스터 데이터 보강 (우선순위: 중)
**대상 테이블**: items, companies, bom, price_master

**작업 내용**:
1. Excel의 모든 품목을 `items` 테이블에 추가
2. Excel의 모든 거래처를 `companies` 테이블에 추가
3. 고객사별 BOM 데이터 전체 이관
4. 최신 단가 데이터 업데이트

**예상 소요 시간**: 2-3시간
**예상 데이터 증가**:
- items: 749 → 950건 (+200)
- companies: 95 → 115건 (+20)
- bom: 347 → 1,347건 (+1,000)
- price_master: 228 → 328건 (+100)

---

### Phase 2: 거래 데이터 대량 이관 (우선순위: 높음) ⭐
**대상 테이블**: sales_transactions, purchase_transactions, collections, payments

**작업 내용**:
1. **매출 거래**: 53건 → 500~1,000건
   - Excel: 납품수량(영업) 시트 (385행)
   - Excel: 종합 일일매출 보고용 (567행)

2. **매입 거래**: 40건 → 240~400건
   - Excel: 매입부자재(구매) 시트 (240행)

3. **수금/지급**: 각 2건 → 100~200건
   - Excel: 정리 시트 (256행)

**예상 소요 시간**: 4-5시간
**중요도**: 🔴 매우 높음 (현재 거래 데이터가 심각하게 부족)

---

### Phase 3: 재고 데이터 이관 (우선순위: 높음)
**대상 테이블**: inventory_transactions, warehouse_stock, coil_specs

**작업 내용**:
1. **재고 거래 이력**: 2,043건 → 5,000~7,000건
   - Excel: COIL/SHEET 입고현황 (합계 769행)
   - Excel: 협력사별 입고현황 (합계 1,158행)

2. **창고별 재고** (신규): 0건 → 400~500건
   - Excel: 종합재고 시트 (392행)

3. **코일 규격** (신규): 0건 → 100~200건
   - Excel: COIL 입고현황에서 추출

**선행 작업**: `warehouses` 테이블 먼저 생성 및 데이터 입력

**예상 소요 시간**: 3-4시간

---

### Phase 4: 생산 데이터 이관 (우선순위: 중)
**대상 테이블**: production_batch, production_batch_items

**작업 내용**:
1. **생산 배치**: 2건 → 200~300건
   - Excel: 생산실적 시트 (95행)
   - Excel: 주간계획 시트 (186행)

2. **배치 품목**: 3건 → 500~800건
   - 각 배치의 상세 품목 내역

**예상 소요 시간**: 2-3시간

---

### Phase 5: 신규 기능 구현 (우선순위: 낮음)
**대상**: 웹에 없는 기능들

**작업 내용**:
1. 주간 생산 계획 모듈
2. 일일 업무 보고 자동 생성
3. 물류 관리 모듈
4. 창고 관리 상세 기능
5. 계약 관리 모듈

**예상 소요 시간**: 각 모듈당 1-2일

---

## ⚠️ 주의사항 및 위험 요소

### 1. 한글 인코딩 (중요!)
- **위험**: Excel UTF-8 → DB 입력 시 깨질 가능성
- **해결**: 검증된 `request.text() + JSON.parse()` 패턴 사용
- **테스트**: 한글 품명/거래처명 우선 테스트

### 2. FK 참조 무결성
- **위험**: Excel의 품번/거래처명이 DB에 없을 수 있음
- **해결**:
  1. 먼저 마스터 데이터(items, companies) 완전 이관
  2. FK 매핑 테이블 생성
  3. 거래 데이터 이관 시 FK 검증

### 3. 날짜 형식
- **위험**: Excel 날짜 직렬 번호 vs DB TIMESTAMP
- **해결**: xlsx 라이브러리의 자동 변환 사용
- **검증**: 날짜 범위 체크 (2025년 9월)

### 4. 수식 vs 실제 값
- **위험**: Excel 수식 셀의 계산값만 가져와야 함
- **해결**: `raw: false` 옵션으로 계산된 값 추출
- **확인**: SUMIF, VLOOKUP 결과값이 올바른지 검증

### 5. 중복 데이터
- **위험**: Excel과 DB에 같은 데이터가 이미 있을 수 있음
- **해결**:
  - 품목: `item_code` 기준 중복 체크
  - 거래: `transaction_no` 기준 중복 체크
  - 거래처: `company_name` 기준 중복 체크

---

## 📌 권장 실행 순서

### 1단계: 사전 준비 (30분)
- [ ] 데이터베이스 백업
- [ ] 테스트 환경 준비
- [ ] FK 매핑 테이블 생성 스크립트 작성

### 2단계: 마스터 데이터 (2-3시간)
- [ ] items 테이블 보강
- [ ] companies 테이블 보강
- [ ] FK 매핑 검증
- [ ] bom 데이터 이관
- [ ] price_master 업데이트

### 3단계: 거래 데이터 (4-5시간) ⭐ 최우선
- [ ] sales_transactions 대량 이관 (53 → 500+)
- [ ] purchase_transactions 대량 이관 (40 → 240+)
- [ ] collections/payments 이관
- [ ] 데이터 검증 및 집계 확인

### 4단계: 재고 데이터 (3-4시간)
- [ ] warehouses 테이블 생성
- [ ] warehouse_stock 이관
- [ ] inventory_transactions 보강
- [ ] coil_specs 이관

### 5단계: 생산 데이터 (2-3시간)
- [ ] production_batch 이관
- [ ] production_batch_items 이관
- [ ] 웹 UI 테스트

### 6단계: 검증 및 정리 (1-2시간)
- [ ] 전체 데이터 건수 확인
- [ ] 대시보드 집계 검증
- [ ] 리포트 생성 테스트
- [ ] 문서화 업데이트

---

## 📊 예상 최종 데이터 규모

| 테이블 | 현재 | 예상 | 증가율 |
|--------|------|------|--------|
| items | 749 | 950 | +27% |
| companies | 95 | 115 | +21% |
| bom | 347 | 1,347 | +288% |
| price_master | 228 | 328 | +44% |
| **sales_transactions** | **53** | **500-1,000** | **+845%** ⭐ |
| **purchase_transactions** | **40** | **240-400** | **+500%** ⭐ |
| inventory_transactions | 2,043 | 5,000-7,000 | +143% |
| collections | 2 | 100-200 | +4,900% |
| payments | 2 | 100-200 | +4,900% |
| production_batch | 2 | 200-300 | +9,900% |
| production_batch_items | 3 | 500-800 | +16,567% |
| warehouse_stock | 0 | 400-500 | +∞ |
| coil_specs | 0 | 100-200 | +∞ |

**전체 예상 증가**: 현재 3,555건 → 예상 9,000~13,000건 (+153~266%)

---

## 🎯 결론 및 다음 단계

### 핵심 발견
1. ✅ **Excel 분석 완료**: 50개 시트, 135,377개 수식, 72,737개 시트간 참조
2. ⚠️ **거래 데이터 심각 부족**: 매출 53건, 매입 40건 (Excel에는 수백 건)
3. ⚠️ **빈 테이블 5개**: 창고, 창고재고, 재고조정, 계약, 코일규격
4. ✅ **마스터 데이터 양호**: items, companies, bom, price_master는 잘 구축됨
5. 🔴 **웹 미반영 기능 다수**: 주간계획, 일일보고, 물류관리 등

### 우선순위 작업
1. **최우선**: Phase 2 - 매출/매입 거래 데이터 대량 이관
2. **높음**: Phase 3 - 재고 데이터 및 창고 관리
3. **중간**: Phase 1 - 마스터 데이터 보강
4. **중간**: Phase 4 - 생산 데이터
5. **낮음**: Phase 5 - 신규 기능 구현

### 다음 단계 제안
사용자님께 확인받을 사항:
1. 데이터 임포트 순서에 동의하시나요?
2. 먼저 매출/매입 거래 데이터부터 시작할까요?
3. 테스트 환경에서 먼저 실행해볼까요, 아니면 바로 Production에 적용할까요?

---

**리포트 작성자**: Claude (Supabase MCP + Excel Analysis)
**리포트 일시**: 2025-02-01
**다음 업데이트**: 데이터 임포트 완료 후
