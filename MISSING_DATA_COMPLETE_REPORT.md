# 누락 거래처 및 제외 데이터 확인 및 추가 완료 보고서

**작성일**: 2025-01-27  
**작업자**: AI Assistant  
**프로젝트**: TAECHANG_ERP

---

## 📊 확인 결과 요약

### 1. 거래처 현황

| 항목 | 수량 |
|------|------|
| **엑셀에서 추출된 거래처** | 54개 |
| **데이터베이스 거래처** | 49개 |
| **누락된 거래처** | 7개 |

**누락된 거래처 목록:**
1. 풍기서산
2. 대우포승
3. 호원오토
4. 신성테크
5. 창경에스테크
6. 제이에스테크
7. 대일씨에프티

**처리 완료:**
- ✅ 7개 거래처 모두 추가 완료

---

### 2. 품목 현황

| 항목 | 수량 |
|------|------|
| **엑셀에서 추출된 품번** | 533개 |
| **데이터베이스 품목** | 199개 |
| **누락된 품번** | 336개 |

**참고:**
- 일부 품번은 음수(-6403 등) 또는 숫자만 포함되어 품번이 아닐 수 있음
- 엑셀의 다양한 셀 값이 품번으로 잘못 인식된 경우 포함
- 실제 누락된 품목 수는 더 적을 수 있음

---

### 3. Inventory Transactions 현황

| 항목 | 수량 | 상태 |
|------|------|------|
| **전체 거래** | 1,788개 | |
| **company_id NULL (초기)** | 665개 | ⚠️ |
| **company_id 업데이트** | 416개 | ✅ |
| **남은 company_id NULL** | 249개 | ⚠️ |

**남은 NULL 거래 분석:**
- 재고관리 시트에서 생성된 거래 (MV1 SV, TAM KA4, DL3 GL3)
- 실적 취합 시트에서 생성된 거래
- 내부 생산/조정 거래로 특정 거래처가 없을 수 있음

**샘플 reference_number:**
- `AUTO-MV1 , SV (재고관리)-입고`
- `AUTO-TAM,KA4,인알파-생산출고`
- `AUTO-실적-취합-D1`

---

### 4. Items 테이블 현황

| 항목 | 수량 |
|------|------|
| **전체 품목** | 199개 |
| **supplier_id NULL** | 199개 (100%) |

**참고:**
- supplier_id는 아직 매핑되지 않음
- 거래처와 품목의 관계 데이터가 필요할 수 있음

---

## ✅ 처리 완료 내역

### 1. 누락된 거래처 추가

**추가된 거래처:**
1. ✅ 풍기서산 (공급사)
2. ✅ 대우포승 (공급사)
3. ✅ 호원오토 (공급사)
4. ✅ 신성테크 (협력사)
5. ✅ 창경에스테크 (협력사)
6. ✅ 제이에스테크 (협력사)
7. ✅ 대일씨에프티 (협력사)

**총 추가: 7개**

---

### 2. company_id 업데이트

**업데이트 방법:**
1. **reference_number에서 거래처 추출** (개선된 정규식)
2. **부분 매칭** (예: "풍기서산" ↔ "풍기서산(사급)")
3. **description에서도 추출 시도**

**결과:**
- ✅ 416개 거래의 company_id 업데이트 완료
- ⚠️ 249개 거래는 여전히 NULL (내부 거래 가능성)

---

## 📈 최종 데이터 현황

### 거래처

- **이전**: 49개
- **추가**: 7개
- **현재**: **56개**

### 거래 (company_id)

- **NULL 거래 (초기)**: 665개
- **업데이트 완료**: 416개 (62.6%)
- **남은 NULL**: 249개 (37.4%)

---

## ⚠️ 남은 이슈

### 1. company_id가 NULL인 거래 (249개)

**원인:**
- 재고관리 시트나 실적 취합 시트에서 생성된 내부 거래
- reference_number에 거래처 정보가 없는 경우

**특성:**
- 대부분 "재고관리", "실적 취합" 등의 시트명 사용
- 내부 생산, 조정, 이동 등의 거래 가능

**권장 조치:**
- 내부 거래는 company_id를 NULL로 유지 (정상)
- 필요시 "내부" 또는 특별 거래처 추가 고려

### 2. supplier_id가 NULL인 품목 (199개, 100%)

**원인:**
- 품목과 주 공급사 간의 관계 데이터 부재
- 엑셀에서 공급사 정보가 품목별로 명시되지 않음

**권장 조치:**
- BOM 시트나 다른 엑셀 파일에서 주 공급사 정보 확인
- 거래 이력에서 가장 많이 거래한 공급사를 주 공급사로 설정

### 3. 누락된 품번 (336개)

**분석 필요:**
- 실제 품번인지 확인 필요
- 일부는 계산식이나 헤더 등의 잘못된 인식일 수 있음

**권장 조치:**
- 엑셀의 실제 품번 컬럼만 정확히 추출하도록 파서 개선
- 음수나 숫자만 있는 값 필터링

---

## ✅ 작업 완료 내역

1. ✅ 누락된 거래처 7개 추가 완료
2. ✅ company_id가 NULL인 거래 416개 업데이트
3. ✅ 거래처 매핑 로직 개선 (부분 매칭, 변형 이름 처리)
4. ✅ 누락 데이터 확인 스크립트 생성
5. ✅ 누락 데이터 추가 스크립트 생성

---

## 📝 기술적 세부사항

### 거래처 매핑 개선 사항

1. **reference_number 파싱 개선:**
   ```typescript
   // 다양한 패턴 처리
   - AUTO-{거래처명}-...
   - AUTO-{거래처명(사급)}-...
   - 부분 매칭 지원
   ```

2. **변형된 이름 매핑:**
   ```typescript
   - "풍기서산" ↔ "풍기서산(사급)"
   - "(사급)" 제거 후 매칭
   - 부분 포함 여부 확인
   ```

3. **시트명 기반 매핑:**
   ```typescript
   - 시트명에서 거래처 추출
   - 시트명 → 거래처 이름 매핑 테이블
   ```

---

## 🎯 결론

✅ **누락된 거래처 및 제외된 데이터 확인 및 추가가 완료되었습니다!**

- 7개 거래처 추가 완료
- 416개 거래의 company_id 업데이트 완료
- 총 거래처: 49개 → 56개

**남은 작업 (선택 사항):**
1. supplier_id 매핑 (품목의 주 공급사)
2. 실제 품번만 정확히 추출하도록 파서 개선
3. 내부 거래의 company_id 처리 (NULL 유지 또는 "내부" 거래처 추가)

---

## 📎 참고 파일

- `scripts/migration/check-missing-data.ts` - 누락 데이터 확인 스크립트
- `scripts/migration/add-missing-data.ts` - 누락 데이터 추가 스크립트
- `scripts/migration/fill-empty-fields.ts` - 빈 필드 채우기 스크립트

